(function(){"use strict";try{if(typeof document<"u"){var o=document.createElement("style");o.appendChild(document.createTextNode("._outter_mjs0y_4{position:fixed;top:0;left:0;z-index:1000;width:0;height:0;all:initial;font-family:system-ui,sans-serif;font-size:1rem;@media (prefers-color-scheme: dark){*{--color-base-0: rgb(0, 0, 0);--color-base-100: #171717;--color-base-200: #343434;--color-base-content: #c2c2c2;--color-primary: rgb(127, 67, 255);--color-primary-content: rgb(227, 218, 237)}}@media (prefers-color-scheme: light){*{--color-base-0: rgb(255, 255, 255);--color-base-100: #e9e9e9;--color-base-200: #c9c9c9;--color-base-content: #171717;--color-primary: rgb(103, 36, 248);--color-primary-content: rgb(227, 218, 237)}}}._backdrop_mjs0y_47{background:rgb(from var(--color-base-0) r g b / 60%);width:100vw;height:100vh;position:fixed;top:0;left:0;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:1000}._container_mjs0y_59{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;color:var(--color-base-content);z-index:1001;button{--color-border: var(--color-base-200);--color-bg: rgb(from var(--color-base-200) r g b / 60%);--color-text: var(--color-base-content);border:none;cursor:pointer;background:transparent;padding:.5em 1em;box-sizing:border-box;color:var(--color-text);transition:all;transition-duration:.15s}button:hover{--color-border: var(--color-base-200);--color-bg: rgb(from var(--color-base-0) r g b / 100%);--color-text: var(--color-base-content)}button:disabled{opacity:50%}button._btn_mjs0y_92{background-color:var(--color-bg);color:var(--color-text);border:solid 1px var(--color-border);padding:.5em 1em;border-radius:.4em;display:inline-flex;justify-content:center;align-items:center}a{color:var(--color-primary)}a:hover{color:var(--color-base-content);text-decoration:underline}}._outter_mjs0y_4,._container_mjs0y_59,._content_mjs0y_114,._backdrop_mjs0y_47{transition:all;transition-duration:.15s}._content_mjs0y_114{max-width:320px;width:320px;background-color:rgb(from var(--color-base-100) r g b / 60%);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);display:block;box-sizing:border-box;border-radius:1em;box-shadow:0 14px 47px -13px #0000000d;-webkit-box-shadow:0px 14px 47px -13px rgba(0,0,0,.05);-moz-box-shadow:0px 14px 47px -13px rgba(0,0,0,.05);border:solid 1px rgb(from var(--color-base-200) r g b / 60%);._head_mjs0y_133{display:flex;width:100%;justify-content:space-between;align-items:center;padding:1em;box-sizing:border-box}._main_mjs0y_141{padding:1em 1.5em}._foot_mjs0y_144{padding:.5em 1em 1.5em;text-align:center;color:rgb(from var(--color-base-content) r g b / 60%)}h3{font-size:1.1rem;line-height:1.2rem;padding:0;margin:0}}._content_mjs0y_114:hover{border:solid 1px rgb(from var(--color-base-200) r g b / 100%)}")),document.head.appendChild(o)}}catch(r){console.error("vite-plugin-css-injected-by-js",r)}})();
"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const it=require("@arweave-wallet-kit/core/strategy"),L=require("solid-js");var Xt=Object.defineProperty,Zt=(i,t,r)=>t in i?Xt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r,Le=(i,t,r)=>(Zt(i,typeof t!="symbol"?t+"":t,r),r);async function de(i,t=[]){return window!=null&&window.arweaveWallet?await window.arweaveWallet[i](...t):new Promise((r,s)=>window.addEventListener("arweaveWalletLoaded",async()=>{try{r(await window.arweaveWallet[i](...t))}catch(n){s(n)}}))}class Yt{constructor(){Le(this,"id","browserwallet"),Le(this,"name","Browser Wallet"),Le(this,"description","Any browser wallet with an injected API"),Le(this,"theme","121,212,131"),Le(this,"logo","KKiSlNKc5K59MXzUPz5qjtCLsl6_ckjAOg9MyAzaUs0")}async isAvailable(){return typeof window>"u"||!window?(console.error(`[Arweave Wallet Kit] "${this.id}" strategy is unavailable. Window is undefined`),!1):window.arweaveWallet?!0:new Promise(t=>{const r=()=>t(!0);window.addEventListener("arweaveWalletLoaded",r),setTimeout(()=>{window.removeEventListener("arweaveWalletLoaded",r),window.arweaveWallet||console.error(`[Arweave Wallet Kit] "${this.id}" strategy is unavailable. window.arweaveWallet is undefined`),t(!!window.arweaveWallet)},7e3)})}async sync(){}async connect(t,r,s){return await de("connect",[t,r,s])}async disconnect(){return await de("disconnect")}async getActiveAddress(){return await de("getActiveAddress")}async getAllAddresses(){return await de("getAllAddresses")}async getPermissions(){return await de("getPermissions")}async getWalletNames(){return await de("getWalletNames")}async sign(t,r){const s=await de("sign",[t,r]);return t.setSignature({id:s.id,owner:s.owner,reward:s.reward,tags:s.tags,signature:s.signature}),t}async signDataItem(t){return await de("signDataItem",[t])}async encrypt(t,r){return await de("encrypt",[t,r])}async decrypt(t,r){return await de("decrypt",[t,r])}async getArweaveConfig(){return await de("getArweaveConfig")}async signature(t,r){return await de("signature",[t,r])}async getActivePublicKey(){return await de("getActivePublicKey")}async dispatch(t){return await de("dispatch",[t])}async addToken(t){throw new Error("Not implemented: "+t)}addAddressEvent(t){const r=s=>t(s.detail.address);return addEventListener("walletSwitch",r),r}removeAddressEvent(t){removeEventListener("walletSwitch",t)}}var Re={},fe={},De={},gt;function Qt(){if(gt)return De;gt=1,De.byteLength=a,De.toByteArray=f,De.fromByteArray=I;for(var i=[],t=[],r=typeof Uint8Array<"u"?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,c=s.length;n<c;++n)i[n]=s[n],t[s.charCodeAt(n)]=n;t[45]=62,t[95]=63;function o(A){var x=A.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var _=A.indexOf("=");_===-1&&(_=x);var B=_===x?0:4-_%4;return[_,B]}function a(A){var x=o(A),_=x[0],B=x[1];return(_+B)*3/4-B}function h(A,x,_){return(x+_)*3/4-_}function f(A){var x,_=o(A),B=_[0],F=_[1],D=new r(h(A,B,F)),W=0,te=F>0?B-4:B,N;for(N=0;N<te;N+=4)x=t[A.charCodeAt(N)]<<18|t[A.charCodeAt(N+1)]<<12|t[A.charCodeAt(N+2)]<<6|t[A.charCodeAt(N+3)],D[W++]=x>>16&255,D[W++]=x>>8&255,D[W++]=x&255;return F===2&&(x=t[A.charCodeAt(N)]<<2|t[A.charCodeAt(N+1)]>>4,D[W++]=x&255),F===1&&(x=t[A.charCodeAt(N)]<<10|t[A.charCodeAt(N+1)]<<4|t[A.charCodeAt(N+2)]>>2,D[W++]=x>>8&255,D[W++]=x&255),D}function C(A){return i[A>>18&63]+i[A>>12&63]+i[A>>6&63]+i[A&63]}function E(A,x,_){for(var B,F=[],D=x;D<_;D+=3)B=(A[D]<<16&16711680)+(A[D+1]<<8&65280)+(A[D+2]&255),F.push(C(B));return F.join("")}function I(A){for(var x,_=A.length,B=_%3,F=[],D=16383,W=0,te=_-B;W<te;W+=D)F.push(E(A,W,W+D>te?te:W+D));return B===1?(x=A[_-1],F.push(i[x>>2]+i[x<<4&63]+"==")):B===2&&(x=(A[_-2]<<8)+A[_-1],F.push(i[x>>10]+i[x>>4&63]+i[x<<2&63]+"=")),F.join("")}return De}var pt;function Te(){if(pt)return fe;pt=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.concatBuffers=t,fe.b64UrlToString=r,fe.bufferToString=s,fe.stringToBuffer=n,fe.stringToB64Url=c,fe.b64UrlToBuffer=o,fe.bufferTob64=a,fe.bufferTob64Url=h,fe.b64UrlEncode=f,fe.b64UrlDecode=C;const i=Qt();function t(E){let I=0;for(let _=0;_<E.length;_++)I+=E[_].byteLength;let A=new Uint8Array(I),x=0;A.set(new Uint8Array(E[0]),x),x+=E[0].byteLength;for(let _=1;_<E.length;_++)A.set(new Uint8Array(E[_]),x),x+=E[_].byteLength;return A}function r(E){let I=o(E);return s(I)}function s(E){return new TextDecoder("utf-8",{fatal:!0}).decode(E)}function n(E){return new TextEncoder().encode(E)}function c(E){return h(n(E))}function o(E){return new Uint8Array(i.toByteArray(C(E)))}function a(E){return i.fromByteArray(new Uint8Array(E))}function h(E){return f(a(E))}function f(E){try{return E.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}catch(I){throw new Error("Failed to encode string",{cause:I})}}function C(E){try{E=E.replace(/\-/g,"+").replace(/\_/g,"/");let I;return E.length%4==0?I=0:I=4-E.length%4,E.concat("=".repeat(I))}catch(I){throw new Error("Failed to decode string",{cause:I})}}return fe}var Me={},Fe={},We={},Ye={exports:{}},er=Ye.exports,wt;function tr(){return wt||(wt=1,function(i){(function(t){var r,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,n=Math.ceil,c=Math.floor,o="[BigNumber Error] ",a=o+"Number primitive has more than 15 significant digits: ",h=1e14,f=14,C=9007199254740991,E=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],I=1e7,A=1e9;function x(O){var R,U,K,P=k.prototype={constructor:k,toString:null,valueOf:null},z=new k(1),H=20,$=4,G=-7,X=21,ce=-1e7,le=1e7,me=!1,Ce=1,pe=0,q={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},Y="0123456789abcdefghijklmnopqrstuvwxyz",Q=!0;function k(l,u){var d,b,p,y,S,g,w,v,m=this;if(!(m instanceof k))return new k(l,u);if(u==null){if(l&&l._isBigNumber===!0){m.s=l.s,!l.c||l.e>le?m.c=m.e=null:l.e<ce?m.c=[m.e=0]:(m.e=l.e,m.c=l.c.slice());return}if((g=typeof l=="number")&&l*0==0){if(m.s=1/l<0?(l=-l,-1):1,l===~~l){for(y=0,S=l;S>=10;S/=10,y++);y>le?m.c=m.e=null:(m.e=y,m.c=[l]);return}v=String(l)}else{if(!s.test(v=String(l)))return K(m,v,g);m.s=v.charCodeAt(0)==45?(v=v.slice(1),-1):1}(y=v.indexOf("."))>-1&&(v=v.replace(".","")),(S=v.search(/e/i))>0?(y<0&&(y=S),y+=+v.slice(S+1),v=v.substring(0,S)):y<0&&(y=v.length)}else{if(D(u,2,Y.length,"Base"),u==10&&Q)return m=new k(l),ie(m,H+m.e+1,$);if(v=String(l),g=typeof l=="number"){if(l*0!=0)return K(m,v,g,u);if(m.s=1/l<0?(v=v.slice(1),-1):1,k.DEBUG&&v.replace(/^0\.0*|\./,"").length>15)throw Error(a+l)}else m.s=v.charCodeAt(0)===45?(v=v.slice(1),-1):1;for(d=Y.slice(0,u),y=S=0,w=v.length;S<w;S++)if(d.indexOf(b=v.charAt(S))<0){if(b=="."){if(S>y){y=w;continue}}else if(!p&&(v==v.toUpperCase()&&(v=v.toLowerCase())||v==v.toLowerCase()&&(v=v.toUpperCase()))){p=!0,S=-1,y=0;continue}return K(m,String(l),g,u)}g=!1,v=U(v,u,10,m.s),(y=v.indexOf("."))>-1?v=v.replace(".",""):y=v.length}for(S=0;v.charCodeAt(S)===48;S++);for(w=v.length;v.charCodeAt(--w)===48;);if(v=v.slice(S,++w)){if(w-=S,g&&k.DEBUG&&w>15&&(l>C||l!==c(l)))throw Error(a+m.s*l);if((y=y-S-1)>le)m.c=m.e=null;else if(y<ce)m.c=[m.e=0];else{if(m.e=y,m.c=[],S=(y+1)%f,y<0&&(S+=f),S<w){for(S&&m.c.push(+v.slice(0,S)),w-=f;S<w;)m.c.push(+v.slice(S,S+=f));S=f-(v=v.slice(S)).length}else S-=w;for(;S--;v+="0");m.c.push(+v)}}else m.c=[m.e=0]}k.clone=x,k.ROUND_UP=0,k.ROUND_DOWN=1,k.ROUND_CEIL=2,k.ROUND_FLOOR=3,k.ROUND_HALF_UP=4,k.ROUND_HALF_DOWN=5,k.ROUND_HALF_EVEN=6,k.ROUND_HALF_CEIL=7,k.ROUND_HALF_FLOOR=8,k.EUCLID=9,k.config=k.set=function(l){var u,d;if(l!=null)if(typeof l=="object"){if(l.hasOwnProperty(u="DECIMAL_PLACES")&&(d=l[u],D(d,0,A,u),H=d),l.hasOwnProperty(u="ROUNDING_MODE")&&(d=l[u],D(d,0,8,u),$=d),l.hasOwnProperty(u="EXPONENTIAL_AT")&&(d=l[u],d&&d.pop?(D(d[0],-1e9,0,u),D(d[1],0,A,u),G=d[0],X=d[1]):(D(d,-1e9,A,u),G=-(X=d<0?-d:d))),l.hasOwnProperty(u="RANGE"))if(d=l[u],d&&d.pop)D(d[0],-1e9,-1,u),D(d[1],1,A,u),ce=d[0],le=d[1];else if(D(d,-1e9,A,u),d)ce=-(le=d<0?-d:d);else throw Error(o+u+" cannot be zero: "+d);if(l.hasOwnProperty(u="CRYPTO"))if(d=l[u],d===!!d)if(d)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))me=d;else throw me=!d,Error(o+"crypto unavailable");else me=d;else throw Error(o+u+" not true or false: "+d);if(l.hasOwnProperty(u="MODULO_MODE")&&(d=l[u],D(d,0,9,u),Ce=d),l.hasOwnProperty(u="POW_PRECISION")&&(d=l[u],D(d,0,A,u),pe=d),l.hasOwnProperty(u="FORMAT"))if(d=l[u],typeof d=="object")q=d;else throw Error(o+u+" not an object: "+d);if(l.hasOwnProperty(u="ALPHABET"))if(d=l[u],typeof d=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(d))Q=d.slice(0,10)=="0123456789",Y=d;else throw Error(o+u+" invalid: "+d)}else throw Error(o+"Object expected: "+l);return{DECIMAL_PLACES:H,ROUNDING_MODE:$,EXPONENTIAL_AT:[G,X],RANGE:[ce,le],CRYPTO:me,MODULO_MODE:Ce,POW_PRECISION:pe,FORMAT:q,ALPHABET:Y}},k.isBigNumber=function(l){if(!l||l._isBigNumber!==!0)return!1;if(!k.DEBUG)return!0;var u,d,b=l.c,p=l.e,y=l.s;e:if({}.toString.call(b)=="[object Array]"){if((y===1||y===-1)&&p>=-1e9&&p<=A&&p===c(p)){if(b[0]===0){if(p===0&&b.length===1)return!0;break e}if(u=(p+1)%f,u<1&&(u+=f),String(b[0]).length==u){for(u=0;u<b.length;u++)if(d=b[u],d<0||d>=h||d!==c(d))break e;if(d!==0)return!0}}}else if(b===null&&p===null&&(y===null||y===1||y===-1))return!0;throw Error(o+"Invalid BigNumber: "+l)},k.maximum=k.max=function(){return Z(arguments,-1)},k.minimum=k.min=function(){return Z(arguments,1)},k.random=function(){var l=9007199254740992,u=Math.random()*l&2097151?function(){return c(Math.random()*l)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(d){var b,p,y,S,g,w=0,v=[],m=new k(z);if(d==null?d=H:D(d,0,A),S=n(d/f),me)if(crypto.getRandomValues){for(b=crypto.getRandomValues(new Uint32Array(S*=2));w<S;)g=b[w]*131072+(b[w+1]>>>11),g>=9e15?(p=crypto.getRandomValues(new Uint32Array(2)),b[w]=p[0],b[w+1]=p[1]):(v.push(g%1e14),w+=2);w=S/2}else if(crypto.randomBytes){for(b=crypto.randomBytes(S*=7);w<S;)g=(b[w]&31)*281474976710656+b[w+1]*1099511627776+b[w+2]*4294967296+b[w+3]*16777216+(b[w+4]<<16)+(b[w+5]<<8)+b[w+6],g>=9e15?crypto.randomBytes(7).copy(b,w):(v.push(g%1e14),w+=7);w=S/7}else throw me=!1,Error(o+"crypto unavailable");if(!me)for(;w<S;)g=u(),g<9e15&&(v[w++]=g%1e14);for(S=v[--w],d%=f,S&&d&&(g=E[f-d],v[w]=c(S/g)*g);v[w]===0;v.pop(),w--);if(w<0)v=[y=0];else{for(y=-1;v[0]===0;v.splice(0,1),y-=f);for(w=1,g=v[0];g>=10;g/=10,w++);w<f&&(y-=f-w)}return m.e=y,m.c=v,m}}(),k.sum=function(){for(var l=1,u=arguments,d=new k(u[0]);l<u.length;)d=d.plus(u[l++]);return d},U=function(){var l="0123456789";function u(d,b,p,y){for(var S,g=[0],w,v=0,m=d.length;v<m;){for(w=g.length;w--;g[w]*=b);for(g[0]+=y.indexOf(d.charAt(v++)),S=0;S<g.length;S++)g[S]>p-1&&(g[S+1]==null&&(g[S+1]=0),g[S+1]+=g[S]/p|0,g[S]%=p)}return g.reverse()}return function(d,b,p,y,S){var g,w,v,m,T,j,M,V,re=d.indexOf("."),ae=H,J=$;for(re>=0&&(m=pe,pe=0,d=d.replace(".",""),V=new k(b),j=V.pow(d.length-re),pe=m,V.c=u(N(B(j.c),j.e,"0"),10,p,l),V.e=V.c.length),M=u(d,b,p,S?(g=Y,l):(g=l,Y)),v=m=M.length;M[--m]==0;M.pop());if(!M[0])return g.charAt(0);if(re<0?--v:(j.c=M,j.e=v,j.s=y,j=R(j,V,ae,J,p),M=j.c,T=j.r,v=j.e),w=v+ae+1,re=M[w],m=p/2,T=T||w<0||M[w+1]!=null,T=J<4?(re!=null||T)&&(J==0||J==(j.s<0?3:2)):re>m||re==m&&(J==4||T||J==6&&M[w-1]&1||J==(j.s<0?8:7)),w<1||!M[0])d=T?N(g.charAt(1),-ae,g.charAt(0)):g.charAt(0);else{if(M.length=w,T)for(--p;++M[--w]>p;)M[w]=0,w||(++v,M=[1].concat(M));for(m=M.length;!M[--m];);for(re=0,d="";re<=m;d+=g.charAt(M[re++]));d=N(d,v,g.charAt(0))}return d}}(),R=function(){function l(b,p,y){var S,g,w,v,m=0,T=b.length,j=p%I,M=p/I|0;for(b=b.slice();T--;)w=b[T]%I,v=b[T]/I|0,S=M*w+v*j,g=j*w+S%I*I+m,m=(g/y|0)+(S/I|0)+M*v,b[T]=g%y;return m&&(b=[m].concat(b)),b}function u(b,p,y,S){var g,w;if(y!=S)w=y>S?1:-1;else for(g=w=0;g<y;g++)if(b[g]!=p[g]){w=b[g]>p[g]?1:-1;break}return w}function d(b,p,y,S){for(var g=0;y--;)b[y]-=g,g=b[y]<p[y]?1:0,b[y]=g*S+b[y]-p[y];for(;!b[0]&&b.length>1;b.splice(0,1));}return function(b,p,y,S,g){var w,v,m,T,j,M,V,re,ae,J,ee,ue,$e,nt,st,ve,Ue,ye=b.s==p.s?1:-1,he=b.c,ne=p.c;if(!he||!he[0]||!ne||!ne[0])return new k(!b.s||!p.s||(he?ne&&he[0]==ne[0]:!ne)?NaN:he&&he[0]==0||!ne?ye*0:ye/0);for(re=new k(ye),ae=re.c=[],v=b.e-p.e,ye=y+v+1,g||(g=h,v=_(b.e/f)-_(p.e/f),ye=ye/f|0),m=0;ne[m]==(he[m]||0);m++);if(ne[m]>(he[m]||0)&&v--,ye<0)ae.push(1),T=!0;else{for(nt=he.length,ve=ne.length,m=0,ye+=2,j=c(g/(ne[0]+1)),j>1&&(ne=l(ne,j,g),he=l(he,j,g),ve=ne.length,nt=he.length),$e=ve,J=he.slice(0,ve),ee=J.length;ee<ve;J[ee++]=0);Ue=ne.slice(),Ue=[0].concat(Ue),st=ne[0],ne[1]>=g/2&&st++;do{if(j=0,w=u(ne,J,ve,ee),w<0){if(ue=J[0],ve!=ee&&(ue=ue*g+(J[1]||0)),j=c(ue/st),j>1)for(j>=g&&(j=g-1),M=l(ne,j,g),V=M.length,ee=J.length;u(M,J,V,ee)==1;)j--,d(M,ve<V?Ue:ne,V,g),V=M.length,w=1;else j==0&&(w=j=1),M=ne.slice(),V=M.length;if(V<ee&&(M=[0].concat(M)),d(J,M,ee,g),ee=J.length,w==-1)for(;u(ne,J,ve,ee)<1;)j++,d(J,ve<ee?Ue:ne,ee,g),ee=J.length}else w===0&&(j++,J=[0]);ae[m++]=j,J[0]?J[ee++]=he[$e]||0:(J=[he[$e]],ee=1)}while(($e++<nt||J[0]!=null)&&ye--);T=J[0]!=null,ae[0]||ae.splice(0,1)}if(g==h){for(m=1,ye=ae[0];ye>=10;ye/=10,m++);ie(re,y+(re.e=m+v*f-1)+1,S,T)}else re.e=v,re.r=+T;return re}}();function se(l,u,d,b){var p,y,S,g,w;if(d==null?d=$:D(d,0,8),!l.c)return l.toString();if(p=l.c[0],S=l.e,u==null)w=B(l.c),w=b==1||b==2&&(S<=G||S>=X)?te(w,S):N(w,S,"0");else if(l=ie(new k(l),u,d),y=l.e,w=B(l.c),g=w.length,b==1||b==2&&(u<=y||y<=G)){for(;g<u;w+="0",g++);w=te(w,y)}else if(u-=S,w=N(w,y,"0"),y+1>g){if(--u>0)for(w+=".";u--;w+="0");}else if(u+=y-g,u>0)for(y+1==g&&(w+=".");u--;w+="0");return l.s<0&&p?"-"+w:w}function Z(l,u){for(var d,b,p=1,y=new k(l[0]);p<l.length;p++)b=new k(l[p]),(!b.s||(d=F(y,b))===u||d===0&&y.s===u)&&(y=b);return y}function we(l,u,d){for(var b=1,p=u.length;!u[--p];u.pop());for(p=u[0];p>=10;p/=10,b++);return(d=b+d*f-1)>le?l.c=l.e=null:d<ce?l.c=[l.e=0]:(l.e=d,l.c=u),l}K=function(){var l=/^(-?)0([xbo])(?=\w[\w.]*$)/i,u=/^([^.]+)\.$/,d=/^\.([^.]+)$/,b=/^-?(Infinity|NaN)$/,p=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(y,S,g,w){var v,m=g?S:S.replace(p,"");if(b.test(m))y.s=isNaN(m)?null:m<0?-1:1;else{if(!g&&(m=m.replace(l,function(T,j,M){return v=(M=M.toLowerCase())=="x"?16:M=="b"?2:8,!w||w==v?j:T}),w&&(v=w,m=m.replace(u,"$1").replace(d,"0.$1")),S!=m))return new k(m,v);if(k.DEBUG)throw Error(o+"Not a"+(w?" base "+w:"")+" number: "+S);y.s=null}y.c=y.e=null}}();function ie(l,u,d,b){var p,y,S,g,w,v,m,T=l.c,j=E;if(T){e:{for(p=1,g=T[0];g>=10;g/=10,p++);if(y=u-p,y<0)y+=f,S=u,w=T[v=0],m=c(w/j[p-S-1]%10);else if(v=n((y+1)/f),v>=T.length)if(b){for(;T.length<=v;T.push(0));w=m=0,p=1,y%=f,S=y-f+1}else break e;else{for(w=g=T[v],p=1;g>=10;g/=10,p++);y%=f,S=y-f+p,m=S<0?0:c(w/j[p-S-1]%10)}if(b=b||u<0||T[v+1]!=null||(S<0?w:w%j[p-S-1]),b=d<4?(m||b)&&(d==0||d==(l.s<0?3:2)):m>5||m==5&&(d==4||b||d==6&&(y>0?S>0?w/j[p-S]:0:T[v-1])%10&1||d==(l.s<0?8:7)),u<1||!T[0])return T.length=0,b?(u-=l.e+1,T[0]=j[(f-u%f)%f],l.e=-u||0):T[0]=l.e=0,l;if(y==0?(T.length=v,g=1,v--):(T.length=v+1,g=j[f-y],T[v]=S>0?c(w/j[p-S]%j[S])*g:0),b)for(;;)if(v==0){for(y=1,S=T[0];S>=10;S/=10,y++);for(S=T[0]+=g,g=1;S>=10;S/=10,g++);y!=g&&(l.e++,T[0]==h&&(T[0]=1));break}else{if(T[v]+=g,T[v]!=h)break;T[v--]=0,g=1}for(y=T.length;T[--y]===0;T.pop());}l.e>le?l.c=l.e=null:l.e<ce&&(l.c=[l.e=0])}return l}function oe(l){var u,d=l.e;return d===null?l.toString():(u=B(l.c),u=d<=G||d>=X?te(u,d):N(u,d,"0"),l.s<0?"-"+u:u)}return P.absoluteValue=P.abs=function(){var l=new k(this);return l.s<0&&(l.s=1),l},P.comparedTo=function(l,u){return F(this,new k(l,u))},P.decimalPlaces=P.dp=function(l,u){var d,b,p,y=this;if(l!=null)return D(l,0,A),u==null?u=$:D(u,0,8),ie(new k(y),l+y.e+1,u);if(!(d=y.c))return null;if(b=((p=d.length-1)-_(this.e/f))*f,p=d[p])for(;p%10==0;p/=10,b--);return b<0&&(b=0),b},P.dividedBy=P.div=function(l,u){return R(this,new k(l,u),H,$)},P.dividedToIntegerBy=P.idiv=function(l,u){return R(this,new k(l,u),0,1)},P.exponentiatedBy=P.pow=function(l,u){var d,b,p,y,S,g,w,v,m,T=this;if(l=new k(l),l.c&&!l.isInteger())throw Error(o+"Exponent not an integer: "+oe(l));if(u!=null&&(u=new k(u)),g=l.e>14,!T.c||!T.c[0]||T.c[0]==1&&!T.e&&T.c.length==1||!l.c||!l.c[0])return m=new k(Math.pow(+oe(T),g?l.s*(2-W(l)):+oe(l))),u?m.mod(u):m;if(w=l.s<0,u){if(u.c?!u.c[0]:!u.s)return new k(NaN);b=!w&&T.isInteger()&&u.isInteger(),b&&(T=T.mod(u))}else{if(l.e>9&&(T.e>0||T.e<-1||(T.e==0?T.c[0]>1||g&&T.c[1]>=24e7:T.c[0]<8e13||g&&T.c[0]<=9999975e7)))return y=T.s<0&&W(l)?-0:0,T.e>-1&&(y=1/y),new k(w?1/y:y);pe&&(y=n(pe/f+2))}for(g?(d=new k(.5),w&&(l.s=1),v=W(l)):(p=Math.abs(+oe(l)),v=p%2),m=new k(z);;){if(v){if(m=m.times(T),!m.c)break;y?m.c.length>y&&(m.c.length=y):b&&(m=m.mod(u))}if(p){if(p=c(p/2),p===0)break;v=p%2}else if(l=l.times(d),ie(l,l.e+1,1),l.e>14)v=W(l);else{if(p=+oe(l),p===0)break;v=p%2}T=T.times(T),y?T.c&&T.c.length>y&&(T.c.length=y):b&&(T=T.mod(u))}return b?m:(w&&(m=z.div(m)),u?m.mod(u):y?ie(m,pe,$,S):m)},P.integerValue=function(l){var u=new k(this);return l==null?l=$:D(l,0,8),ie(u,u.e+1,l)},P.isEqualTo=P.eq=function(l,u){return F(this,new k(l,u))===0},P.isFinite=function(){return!!this.c},P.isGreaterThan=P.gt=function(l,u){return F(this,new k(l,u))>0},P.isGreaterThanOrEqualTo=P.gte=function(l,u){return(u=F(this,new k(l,u)))===1||u===0},P.isInteger=function(){return!!this.c&&_(this.e/f)>this.c.length-2},P.isLessThan=P.lt=function(l,u){return F(this,new k(l,u))<0},P.isLessThanOrEqualTo=P.lte=function(l,u){return(u=F(this,new k(l,u)))===-1||u===0},P.isNaN=function(){return!this.s},P.isNegative=function(){return this.s<0},P.isPositive=function(){return this.s>0},P.isZero=function(){return!!this.c&&this.c[0]==0},P.minus=function(l,u){var d,b,p,y,S=this,g=S.s;if(l=new k(l,u),u=l.s,!g||!u)return new k(NaN);if(g!=u)return l.s=-u,S.plus(l);var w=S.e/f,v=l.e/f,m=S.c,T=l.c;if(!w||!v){if(!m||!T)return m?(l.s=-u,l):new k(T?S:NaN);if(!m[0]||!T[0])return T[0]?(l.s=-u,l):new k(m[0]?S:$==3?-0:0)}if(w=_(w),v=_(v),m=m.slice(),g=w-v){for((y=g<0)?(g=-g,p=m):(v=w,p=T),p.reverse(),u=g;u--;p.push(0));p.reverse()}else for(b=(y=(g=m.length)<(u=T.length))?g:u,g=u=0;u<b;u++)if(m[u]!=T[u]){y=m[u]<T[u];break}if(y&&(p=m,m=T,T=p,l.s=-l.s),u=(b=T.length)-(d=m.length),u>0)for(;u--;m[d++]=0);for(u=h-1;b>g;){if(m[--b]<T[b]){for(d=b;d&&!m[--d];m[d]=u);--m[d],m[b]+=h}m[b]-=T[b]}for(;m[0]==0;m.splice(0,1),--v);return m[0]?we(l,m,v):(l.s=$==3?-1:1,l.c=[l.e=0],l)},P.modulo=P.mod=function(l,u){var d,b,p=this;return l=new k(l,u),!p.c||!l.s||l.c&&!l.c[0]?new k(NaN):!l.c||p.c&&!p.c[0]?new k(p):(Ce==9?(b=l.s,l.s=1,d=R(p,l,0,3),l.s=b,d.s*=b):d=R(p,l,0,Ce),l=p.minus(d.times(l)),!l.c[0]&&Ce==1&&(l.s=p.s),l)},P.multipliedBy=P.times=function(l,u){var d,b,p,y,S,g,w,v,m,T,j,M,V,re,ae,J=this,ee=J.c,ue=(l=new k(l,u)).c;if(!ee||!ue||!ee[0]||!ue[0])return!J.s||!l.s||ee&&!ee[0]&&!ue||ue&&!ue[0]&&!ee?l.c=l.e=l.s=null:(l.s*=J.s,!ee||!ue?l.c=l.e=null:(l.c=[0],l.e=0)),l;for(b=_(J.e/f)+_(l.e/f),l.s*=J.s,w=ee.length,T=ue.length,w<T&&(V=ee,ee=ue,ue=V,p=w,w=T,T=p),p=w+T,V=[];p--;V.push(0));for(re=h,ae=I,p=T;--p>=0;){for(d=0,j=ue[p]%ae,M=ue[p]/ae|0,S=w,y=p+S;y>p;)v=ee[--S]%ae,m=ee[S]/ae|0,g=M*v+m*j,v=j*v+g%ae*ae+V[y]+d,d=(v/re|0)+(g/ae|0)+M*m,V[y--]=v%re;V[y]=d}return d?++b:V.splice(0,1),we(l,V,b)},P.negated=function(){var l=new k(this);return l.s=-l.s||null,l},P.plus=function(l,u){var d,b=this,p=b.s;if(l=new k(l,u),u=l.s,!p||!u)return new k(NaN);if(p!=u)return l.s=-u,b.minus(l);var y=b.e/f,S=l.e/f,g=b.c,w=l.c;if(!y||!S){if(!g||!w)return new k(p/0);if(!g[0]||!w[0])return w[0]?l:new k(g[0]?b:p*0)}if(y=_(y),S=_(S),g=g.slice(),p=y-S){for(p>0?(S=y,d=w):(p=-p,d=g),d.reverse();p--;d.push(0));d.reverse()}for(p=g.length,u=w.length,p-u<0&&(d=w,w=g,g=d,u=p),p=0;u;)p=(g[--u]=g[u]+w[u]+p)/h|0,g[u]=h===g[u]?0:g[u]%h;return p&&(g=[p].concat(g),++S),we(l,g,S)},P.precision=P.sd=function(l,u){var d,b,p,y=this;if(l!=null&&l!==!!l)return D(l,1,A),u==null?u=$:D(u,0,8),ie(new k(y),l,u);if(!(d=y.c))return null;if(p=d.length-1,b=p*f+1,p=d[p]){for(;p%10==0;p/=10,b--);for(p=d[0];p>=10;p/=10,b++);}return l&&y.e+1>b&&(b=y.e+1),b},P.shiftedBy=function(l){return D(l,-9007199254740991,C),this.times("1e"+l)},P.squareRoot=P.sqrt=function(){var l,u,d,b,p,y=this,S=y.c,g=y.s,w=y.e,v=H+4,m=new k("0.5");if(g!==1||!S||!S[0])return new k(!g||g<0&&(!S||S[0])?NaN:S?y:1/0);if(g=Math.sqrt(+oe(y)),g==0||g==1/0?(u=B(S),(u.length+w)%2==0&&(u+="0"),g=Math.sqrt(+u),w=_((w+1)/2)-(w<0||w%2),g==1/0?u="5e"+w:(u=g.toExponential(),u=u.slice(0,u.indexOf("e")+1)+w),d=new k(u)):d=new k(g+""),d.c[0]){for(w=d.e,g=w+v,g<3&&(g=0);;)if(p=d,d=m.times(p.plus(R(y,p,v,1))),B(p.c).slice(0,g)===(u=B(d.c)).slice(0,g))if(d.e<w&&--g,u=u.slice(g-3,g+1),u=="9999"||!b&&u=="4999"){if(!b&&(ie(p,p.e+H+2,0),p.times(p).eq(y))){d=p;break}v+=4,g+=4,b=1}else{(!+u||!+u.slice(1)&&u.charAt(0)=="5")&&(ie(d,d.e+H+2,1),l=!d.times(d).eq(y));break}}return ie(d,d.e+H+1,$,l)},P.toExponential=function(l,u){return l!=null&&(D(l,0,A),l++),se(this,l,u,1)},P.toFixed=function(l,u){return l!=null&&(D(l,0,A),l=l+this.e+1),se(this,l,u)},P.toFormat=function(l,u,d){var b,p=this;if(d==null)l!=null&&u&&typeof u=="object"?(d=u,u=null):l&&typeof l=="object"?(d=l,l=u=null):d=q;else if(typeof d!="object")throw Error(o+"Argument not an object: "+d);if(b=p.toFixed(l,u),p.c){var y,S=b.split("."),g=+d.groupSize,w=+d.secondaryGroupSize,v=d.groupSeparator||"",m=S[0],T=S[1],j=p.s<0,M=j?m.slice(1):m,V=M.length;if(w&&(y=g,g=w,w=y,V-=y),g>0&&V>0){for(y=V%g||g,m=M.substr(0,y);y<V;y+=g)m+=v+M.substr(y,g);w>0&&(m+=v+M.slice(y)),j&&(m="-"+m)}b=T?m+(d.decimalSeparator||"")+((w=+d.fractionGroupSize)?T.replace(new RegExp("\\d{"+w+"}\\B","g"),"$&"+(d.fractionGroupSeparator||"")):T):m}return(d.prefix||"")+b+(d.suffix||"")},P.toFraction=function(l){var u,d,b,p,y,S,g,w,v,m,T,j,M=this,V=M.c;if(l!=null&&(g=new k(l),!g.isInteger()&&(g.c||g.s!==1)||g.lt(z)))throw Error(o+"Argument "+(g.isInteger()?"out of range: ":"not an integer: ")+oe(g));if(!V)return new k(M);for(u=new k(z),v=d=new k(z),b=w=new k(z),j=B(V),y=u.e=j.length-M.e-1,u.c[0]=E[(S=y%f)<0?f+S:S],l=!l||g.comparedTo(u)>0?y>0?u:v:g,S=le,le=1/0,g=new k(j),w.c[0]=0;m=R(g,u,0,1),p=d.plus(m.times(b)),p.comparedTo(l)!=1;)d=b,b=p,v=w.plus(m.times(p=v)),w=p,u=g.minus(m.times(p=u)),g=p;return p=R(l.minus(d),b,0,1),w=w.plus(p.times(v)),d=d.plus(p.times(b)),w.s=v.s=M.s,y=y*2,T=R(v,b,y,$).minus(M).abs().comparedTo(R(w,d,y,$).minus(M).abs())<1?[v,b]:[w,d],le=S,T},P.toNumber=function(){return+oe(this)},P.toPrecision=function(l,u){return l!=null&&D(l,1,A),se(this,l,u,2)},P.toString=function(l){var u,d=this,b=d.s,p=d.e;return p===null?b?(u="Infinity",b<0&&(u="-"+u)):u="NaN":(l==null?u=p<=G||p>=X?te(B(d.c),p):N(B(d.c),p,"0"):l===10&&Q?(d=ie(new k(d),H+p+1,$),u=N(B(d.c),d.e,"0")):(D(l,2,Y.length,"Base"),u=U(N(B(d.c),p,"0"),10,l,b,!0)),b<0&&d.c[0]&&(u="-"+u)),u},P.valueOf=P.toJSON=function(){return oe(this)},P._isBigNumber=!0,O!=null&&k.set(O),k}function _(O){var R=O|0;return O>0||O===R?R:R-1}function B(O){for(var R,U,K=1,P=O.length,z=O[0]+"";K<P;){for(R=O[K++]+"",U=f-R.length;U--;R="0"+R);z+=R}for(P=z.length;z.charCodeAt(--P)===48;);return z.slice(0,P+1||1)}function F(O,R){var U,K,P=O.c,z=R.c,H=O.s,$=R.s,G=O.e,X=R.e;if(!H||!$)return null;if(U=P&&!P[0],K=z&&!z[0],U||K)return U?K?0:-$:H;if(H!=$)return H;if(U=H<0,K=G==X,!P||!z)return K?0:!P^U?1:-1;if(!K)return G>X^U?1:-1;for($=(G=P.length)<(X=z.length)?G:X,H=0;H<$;H++)if(P[H]!=z[H])return P[H]>z[H]^U?1:-1;return G==X?0:G>X^U?1:-1}function D(O,R,U,K){if(O<R||O>U||O!==c(O))throw Error(o+(K||"Argument")+(typeof O=="number"?O<R||O>U?" out of range: ":" not an integer: ":" not a primitive number: ")+String(O))}function W(O){var R=O.c.length-1;return _(O.e/f)==R&&O.c[R]%2!=0}function te(O,R){return(O.length>1?O.charAt(0)+"."+O.slice(1):O)+(R<0?"e":"e+")+R}function N(O,R,U){var K,P;if(R<0){for(P=U+".";++R;P+=U);O=P+O}else if(K=O.length,++R>K){for(P=U,R-=K;--R;P+=U);O+=P}else R<K&&(O=O.slice(0,R)+"."+O.slice(R));return O}r=x(),r.default=r.BigNumber=r,i.exports?i.exports=r:(t||(t=typeof self<"u"&&self?self:window),t.BigNumber=r)})(er)}(Ye)),Ye.exports}var yt;function rr(){if(yt)return We;yt=1,Object.defineProperty(We,"__esModule",{value:!0});const i=tr();class t{BigNum;constructor(){this.BigNum=(s,n)=>{let c=i.BigNumber.clone({DECIMAL_PLACES:n});return new c(s)}}winstonToAr(s,{formatted:n=!1,decimals:c=12,trim:o=!0}={}){let a=this.stringToBigNum(s,c).shiftedBy(-12);return n?a.toFormat(c):a.toFixed(c)}arToWinston(s,{formatted:n=!1}={}){let c=this.stringToBigNum(s).shiftedBy(12);return n?c.toFormat():c.toFixed(0)}compare(s,n){let c=this.stringToBigNum(s),o=this.stringToBigNum(n);return c.comparedTo(o)}isEqual(s,n){return this.compare(s,n)===0}isLessThan(s,n){let c=this.stringToBigNum(s),o=this.stringToBigNum(n);return c.isLessThan(o)}isGreaterThan(s,n){let c=this.stringToBigNum(s),o=this.stringToBigNum(n);return c.isGreaterThan(o)}add(s,n){let c=this.stringToBigNum(s);return this.stringToBigNum(n),c.plus(n).toFixed(0)}sub(s,n){let c=this.stringToBigNum(s);return this.stringToBigNum(n),c.minus(n).toFixed(0)}stringToBigNum(s,n=12){return this.BigNum(s,n)}}return We.default=t,We}var Ke={},mt;function nr(){if(mt)return Ke;mt=1,Object.defineProperty(Ke,"__esModule",{value:!0});class i{METHOD_GET="GET";METHOD_POST="POST";config;constructor(n){this.applyConfig(n)}applyConfig(n){this.config=this.mergeDefaults(n)}getConfig(){return this.config}mergeDefaults(n){const c=n.protocol||"http",o=n.port||(c==="https"?443:80);return{host:n.host||"127.0.0.1",protocol:c,port:o,timeout:n.timeout||2e4,logging:n.logging||!1,logger:n.logger||console.log,network:n.network}}async get(n,c){return await this.request(n,{...c,method:this.METHOD_GET})}async post(n,c,o){const a=new Headers(o?.headers||{});return a.get("content-type")?.includes("application/json")||a.append("content-type","application/json"),a.append("accept","application/json, text/plain, */*"),await this.request(n,{...o,method:this.METHOD_POST,body:typeof c!="string"?JSON.stringify(c):c,headers:a})}async request(n,c){const o=new Headers(c?.headers||{}),a=`${this.config.protocol}://${this.config.host}:${this.config.port}`,h=c?.responseType;delete c?.responseType,n.startsWith("/")&&(n=n.slice(1)),this.config.network&&o.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${a}/${n}`);let f=await fetch(`${a}/${n}`,{...c||{},headers:o});this.config.logging&&this.config.logger(`Response:   ${f.url} - ${f.status}`);const E=f.headers.get("content-type")?.match(/charset=([^()<>@,;:\"/[\]?.=\s]*)/i)?.[1],I=f,A=async()=>{if(E)try{I.data=new TextDecoder(E).decode(await f.arrayBuffer())}catch{I.data=await f.text()}else I.data=await f.text()};if(h==="arraybuffer")I.data=await f.arrayBuffer();else if(h==="text")await A();else if(h==="webstream")I.data=t(f.body);else try{let x=await f.clone().json();typeof x!="object"?await A():I.data=await f.json(),x=null}catch{await A()}return I}}Ke.default=i;const t=s=>{const n=s;return typeof n[Symbol.asyncIterator]>"u"&&(n[Symbol.asyncIterator]=r(s)),n},r=function(s){return async function*(){const c=s.getReader();try{for(;;){const{done:o,value:a}=await c.read();if(o)return;yield a}}finally{c.releaseLock()}}};return Ke}var He={},bt;function sr(){if(bt)return He;bt=1,Object.defineProperty(He,"__esModule",{value:!0});const i=Te();class t{keyLength=4096;publicExponent=65537;hashAlgorithm="sha256";driver;constructor(){if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let s=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),n=await this.driver.exportKey("jwk",s.privateKey);return{kty:n.kty,e:n.e,n:n.n,d:n.d,p:n.p,q:n.q,dp:n.dp,dq:n.dq,qi:n.qi}}async sign(s,n,{saltLength:c}={}){let o=await this.driver.sign({name:"RSA-PSS",saltLength:c??32},await this.jwkToCryptoKey(s),n);return new Uint8Array(o)}async hash(s,n="SHA-256"){let c=await this.driver.digest(n,s);return new Uint8Array(c)}async verify(s,n,c){const o={kty:"RSA",e:"AQAB",n:s},a=await this.jwkToPublicCryptoKey(o),h=await this.driver.digest("SHA-256",n),f=await this.driver.verify({name:"RSA-PSS",saltLength:0},a,c,n),C=await this.driver.verify({name:"RSA-PSS",saltLength:32},a,c,n),E=Math.ceil((a.algorithm.modulusLength-1)/8)-h.byteLength-2,I=await this.driver.verify({name:"RSA-PSS",saltLength:E},a,c,n),A=f||C||I;if(!A){const x={algorithm:a.algorithm.name,modulusLength:a.algorithm.modulusLength,keyUsages:a.usages,saltLengthsAttempted:`0, 32, ${E}`};console.warn(`Transaction Verification Failed! 
`,`Details: ${JSON.stringify(x,null,2)} 
`,"N.B. ArweaveJS is only guaranteed to verify txs created using ArweaveJS.")}return A}async jwkToCryptoKey(s){return this.driver.importKey("jwk",s,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(s){return this.driver.importKey("jwk",s,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;const s=crypto?.subtle;return s===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(c=>typeof s[c]=="function")}async encrypt(s,n,c){const o=await this.driver.importKey("raw",typeof n=="string"?i.stringToBuffer(n):n,{name:"PBKDF2",length:32},!1,["deriveKey"]),a=await this.driver.deriveKey({name:"PBKDF2",salt:c?i.stringToBuffer(c):i.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},o,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),h=new Uint8Array(16);crypto.getRandomValues(h);const f=await this.driver.encrypt({name:"AES-CBC",iv:h},a,s);return i.concatBuffers([h,f])}async decrypt(s,n,c){const o=await this.driver.importKey("raw",typeof n=="string"?i.stringToBuffer(n):n,{name:"PBKDF2",length:32},!1,["deriveKey"]),a=await this.driver.deriveKey({name:"PBKDF2",salt:c?i.stringToBuffer(c):i.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},o,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),h=s.slice(0,16),f=await this.driver.decrypt({name:"AES-CBC",iv:h},a,s.slice(16));return i.concatBuffers([f])}}return He.default=t,He}var Ge={},vt;function ir(){if(vt)return Ge;vt=1,Object.defineProperty(Ge,"__esModule",{value:!0});class i{api;constructor(r){this.api=r}getInfo(){return this.api.get("info").then(r=>r.data)}getPeers(){return this.api.get("peers").then(r=>r.data)}}return Ge.default=i,Ge}var Je={},Be={},St;function tt(){if(St)return Be;St=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.getError=t;class i extends Error{type;response;constructor(s,n={}){n.message?super(n.message):super(),this.type=s,this.response=n.response}getType(){return this.type}}Be.default=i;function t(r){let s=r.data;if(typeof r.data=="string")try{s=JSON.parse(r.data)}catch{}if(r.data instanceof ArrayBuffer||r.data instanceof Uint8Array)try{s=JSON.parse(s.toString())}catch{}return s?s.error||s:r.statusText||"unknown"}return Be}var qe={},ot={},At;function Ft(){return At||(At=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.arrayCompare=i.MIN_CHUNK_SIZE=i.MAX_CHUNK_SIZE=void 0,i.chunkData=c,i.generateLeaves=o,i.computeRootHash=a,i.generateTree=h,i.generateTransactionChunks=f,i.buildLayers=C,i.generateProofs=E,i.arrayFlatten=A,i.intToBuffer=B,i.bufferToInt=F,i.validatePath=W,i.debug=te;const t=Qe(),r=Te();i.MAX_CHUNK_SIZE=256*1024,i.MIN_CHUNK_SIZE=32*1024;const s=32,n=32;async function c(N){let O=[],R=N,U=0;for(;R.byteLength>=i.MAX_CHUNK_SIZE;){let K=i.MAX_CHUNK_SIZE,P=R.byteLength-i.MAX_CHUNK_SIZE;P>0&&P<i.MIN_CHUNK_SIZE&&(K=Math.ceil(R.byteLength/2));const z=R.slice(0,K),H=await t.default.crypto.hash(z);U+=z.byteLength,O.push({dataHash:H,minByteRange:U-z.byteLength,maxByteRange:U}),R=R.slice(K)}return O.push({dataHash:await t.default.crypto.hash(R),minByteRange:U,maxByteRange:U+R.byteLength}),O}async function o(N){return Promise.all(N.map(async({dataHash:O,minByteRange:R,maxByteRange:U})=>({type:"leaf",id:await _(await Promise.all([_(O),_(B(U))])),dataHash:O,minByteRange:R,maxByteRange:U})))}async function a(N){return(await h(N)).id}async function h(N){return await C(await o(await c(N)))}async function f(N){const O=await c(N),R=await o(O),U=await C(R),K=await E(U),P=O.slice(-1)[0];return P.maxByteRange-P.minByteRange===0&&(O.splice(O.length-1,1),K.splice(K.length-1,1)),{data_root:U.id,chunks:O,proofs:K}}async function C(N,O=0){if(N.length<2)return N[0];const R=[];for(let U=0;U<N.length;U+=2)R.push(await x(N[U],N[U+1]));return C(R,O+1)}function E(N){const O=I(N);return Array.isArray(O)?A(O):[O]}function I(N,O=new Uint8Array,R=0){if(N.type=="leaf")return{offset:N.maxByteRange-1,proof:(0,r.concatBuffers)([O,N.dataHash,B(N.maxByteRange)])};if(N.type=="branch"){const U=(0,r.concatBuffers)([O,N.leftChild.id,N.rightChild.id,B(N.byteRange)]);return[I(N.leftChild,U,R+1),I(N.rightChild,U,R+1)]}throw new Error("Unexpected node type")}function A(N){const O=[];return N.forEach(R=>{Array.isArray(R)?O.push(...A(R)):O.push(R)}),O}async function x(N,O){return O?{type:"branch",id:await _([await _(N.id),await _(O.id),await _(B(N.maxByteRange))]),byteRange:N.maxByteRange,maxByteRange:O.maxByteRange,leftChild:N,rightChild:O}:N}async function _(N){return Array.isArray(N)&&(N=t.default.utils.concatBuffers(N)),new Uint8Array(await t.default.crypto.hash(N))}function B(N){const O=new Uint8Array(s);for(var R=O.length-1;R>=0;R--){var U=N%256;O[R]=U,N=(N-U)/256}return O}function F(N){let O=0;for(var R=0;R<N.length;R++)O*=256,O+=N[R];return O}const D=(N,O)=>N.every((R,U)=>O[U]===R);i.arrayCompare=D;async function W(N,O,R,U,K){if(U<=0)return!1;if(O>=U)return W(N,0,U-1,U,K);if(O<0)return W(N,0,0,U,K);if(K.length==n+s){const ce=K.slice(0,n),le=K.slice(ce.length,ce.length+s),me=await _([await _(ce),await _(le)]);return(0,i.arrayCompare)(N,me)?{offset:U-1,leftBound:R,rightBound:U,chunkSize:U-R}:!1}const P=K.slice(0,n),z=K.slice(P.length,P.length+n),H=K.slice(P.length+z.length,P.length+z.length+s),$=F(H),G=K.slice(P.length+z.length+H.length),X=await _([await _(P),await _(z),await _(H)]);return(0,i.arrayCompare)(N,X)?O<$?await W(P,O,R,Math.min(U,$),G):await W(z,O,Math.max(R,$),U,G):!1}async function te(N,O=""){if(N.byteLength<1)return O;const R=N.slice(0,n),U=N.slice(R.length,R.length+n),K=N.slice(R.length+U.length,R.length+U.length+s),P=F(K),z=N.slice(R.length+U.length+K.length),H=await _([await _(R),await _(U),await _(K)]),$=`${O}
${JSON.stringify(Buffer.from(R))},${JSON.stringify(Buffer.from(U))},${P} => ${JSON.stringify(H)}`;return te(z,$)}}(ot)),ot}var Ct;function or(){if(Ct)return qe;Ct=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.TransactionUploader=void 0;const i=rt(),t=Te(),r=tt(),s=Ft(),n=1,c=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],o=1e3*40;class a{api;chunkIndex=0;txPosted=!1;transaction;lastRequestTimeEnd=0;totalErrors=0;data;lastResponseStatus=0;lastResponseError="";get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}constructor(f,C){if(this.api=f,!C.id)throw new Error("Transaction is not signed");if(!C.chunks)throw new Error("Transaction chunks not prepared");this.data=C.data,this.transaction=new i.default(Object.assign({},C,{data:new Uint8Array(0)}))}async uploadChunk(f){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let C=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+o-Date.now(),o);if(C>0&&(C=C-C*Math.random()*.3,await new Promise(x=>setTimeout(x,C))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}f&&(this.chunkIndex=f);const E=this.transaction.getChunk(f||this.chunkIndex,this.data);if(!await(0,s.validatePath)(this.transaction.chunks.data_root,parseInt(E.offset),0,parseInt(E.data_size),t.b64UrlToBuffer(E.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);const A=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(x=>(console.error(x.message),{status:-1,data:{error:x.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=A.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,r.getError)(A),c.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(f,C,E){if(!C||typeof C.chunkIndex!="number"||typeof C.transaction!="object")throw new Error("Serialized object does not match expected format.");var I=new i.default(C.transaction);I.chunks||await I.prepareChunks(E);const A=new a(f,I);if(A.chunkIndex=C.chunkIndex,A.lastRequestTimeEnd=C.lastRequestTimeEnd,A.lastResponseError=C.lastResponseError,A.lastResponseStatus=C.lastResponseStatus,A.txPosted=C.txPosted,A.data=E,A.transaction.data_root!==C.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return A}static async fromTransactionId(f,C){const E=await f.get(`tx/${C}`);if(E.status!==200)throw new Error(`Tx ${C} not found: ${E.status}`);const I=E.data;return I.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:I}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=n){this.transaction.data=this.data;const E=await this.api.post("tx",this.transaction).catch(I=>(console.error(I),{status:-1,data:{error:I.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=E.status,this.transaction.data=new Uint8Array(0),E.status>=200&&E.status<300){this.txPosted=!0,this.chunkIndex=n;return}throw this.lastResponseError=(0,r.getError)(E),new Error(`Unable to upload transaction: ${E.status}, ${this.lastResponseError}`)}const C=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=C.status,!(C.status>=200&&C.status<300))throw this.lastResponseError=(0,r.getError)(C),new Error(`Unable to upload transaction: ${C.status}, ${this.lastResponseError}`);this.txPosted=!0}}return qe.TransactionUploader=a,qe}var Et;function ar(){if(Et)return Je;Et=1,Object.defineProperty(Je,"__esModule",{value:!0});const i=tt(),t=rt(),r=Te(),s=or();class n{api;crypto;chunks;constructor(o,a,h){this.api=o,this.crypto=a,this.chunks=h}async getTransactionAnchor(){const o=await this.api.get("tx_anchor");if(!o.data.match(/^[a-z0-9_-]{43,}/i)||!o.ok)throw new Error(`Could not getTransactionAnchor. Received: ${o.data}. Status: ${o.status}, ${o.statusText}`);return o.data}async getPrice(o,a){let h=a?`price/${o}/${a}`:`price/${o}`;const f=await this.api.get(h);if(!/^\d+$/.test(f.data)||!f.ok)throw new Error(`Could not getPrice. Received: ${f.data}. Status: ${f.status}, ${f.statusText}`);return f.data}async get(o){const a=await this.api.get(`tx/${o}`);if(a.status==200){const h=parseInt(a.data.data_size);if(a.data.format>=2&&h>0&&h<=1024*1024*12){const f=await this.getData(o);return new t.default({...a.data,data:f})}return new t.default({...a.data,format:a.data.format||1})}throw a.status==404?new i.default("TX_NOT_FOUND"):a.status==410?new i.default("TX_FAILED"):new i.default("TX_INVALID")}fromRaw(o){return new t.default(o)}async search(o,a){return this.api.post("arql",{op:"equals",expr1:o,expr2:a}).then(h=>h.data?h.data:[])}getStatus(o){return this.api.get(`tx/${o}/status`).then(a=>a.status==200?{status:200,confirmed:a.data}:{status:a.status,confirmed:null})}async getData(o,a){let h;try{h=await this.chunks.downloadChunkedData(o)}catch(f){console.error(`Error while trying to download chunked data for ${o}`),console.error(f)}if(!h){console.warn(`Falling back to gateway cache for ${o}`);try{const{data:f,ok:C,status:E,statusText:I}=await this.api.get(`/${o}`,{responseType:"arraybuffer"});if(!C)throw new Error("Bad http status code",{cause:{status:E,statusText:I}});h=f}catch(f){console.error(`Error while trying to download contiguous data from gateway cache for ${o}`),console.error(f)}}if(!h)throw new Error(`${o} data was not found!`);return a&&a.decode&&!a.string?h:a&&a.decode&&a.string?r.bufferToString(h):r.bufferTob64Url(h)}async sign(o,a,h){const C=typeof a=="object"&&(I=>{let A=!0;return["n","e","d","p","q","dp","dq","qi"].map(x=>!(x in I)&&(A=!1)),A})(a),E=typeof arweaveWallet=="object";if(!C&&!E)throw new Error("No valid JWK or external wallet found to sign transaction.");if(C){o.setOwner(a.n);let I=await o.getSignatureData(),A=await this.crypto.sign(a,I,h),x=await this.crypto.hash(A);o.setSignature({id:r.bufferTob64Url(x),owner:a.n,signature:r.bufferTob64Url(A)})}else if(E){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}const I=await arweaveWallet.sign(o,h);o.setSignature({id:I.id,owner:I.owner,reward:I.reward,tags:I.tags,signature:I.signature})}else throw new Error("An error occurred while signing. Check wallet is valid")}async verify(o){const a=await o.getSignatureData(),h=o.get("signature",{decode:!0,string:!1}),f=r.bufferTob64Url(await this.crypto.hash(h));if(o.id!==f)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(o.owner,a,h)}async post(o){if(typeof o=="string"?o=new t.default(JSON.parse(o)):typeof o.readInt32BE=="function"?o=new t.default(JSON.parse(o.toString())):typeof o=="object"&&!(o instanceof t.default)&&(o=new t.default(o)),!(o instanceof t.default))throw new Error("Must be Transaction object");o.chunks||await o.prepareChunks(o.data);const a=await this.getUploader(o,o.data);try{for(;!a.isComplete;)await a.uploadChunk()}catch(h){if(a.lastResponseStatus>0)return{status:a.lastResponseStatus,statusText:a.lastResponseError,data:{error:a.lastResponseError}};throw h}return{status:200,statusText:"OK",data:{}}}async getUploader(o,a){let h;if(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),o instanceof t.default){if(a||(a=o.data),!(a instanceof Uint8Array))throw new Error("Data format is invalid");o.chunks||await o.prepareChunks(a),h=new s.TransactionUploader(this.api,o),(!h.data||h.data.length===0)&&(h.data=a)}else{if(typeof o=="string"&&(o=await s.TransactionUploader.fromTransactionId(this.api,o)),!a||!(a instanceof Uint8Array))throw new Error("Must provide data when resuming upload");h=await s.TransactionUploader.fromSerialized(this.api,o,a)}return h}async*upload(o,a){const h=await this.getUploader(o,a);for(;!h.isComplete;)await h.uploadChunk(),yield h;return h}}return Je.default=n,Je}var ze={},Tt;function cr(){if(Tt)return ze;Tt=1,Object.defineProperty(ze,"__esModule",{value:!0});const i=Te();class t{api;crypto;constructor(s,n){this.api=s,this.crypto=n}getBalance(s){return this.api.get(`wallet/${s}/balance`).then(n=>n.data)}getLastTransactionID(s){return this.api.get(`wallet/${s}/last_tx`).then(n=>n.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(s){return!s||s==="use_wallet"?this.getAddress():this.getAddress(s)}async getAddress(s){if(!s||s==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(s.n)}async ownerToAddress(s){return i.bufferTob64Url(await this.crypto.hash(i.b64UrlToBuffer(s)))}}return ze.default=t,ze}var Pe={},Ot;function lr(){if(Ot)return Pe;Ot=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.SiloResource=void 0;const i=Te();class t{api;crypto;transactions;constructor(n,c,o){this.api=n,this.crypto=c,this.transactions=o}async get(n){if(!n)throw new Error("No Silo URI specified");const c=await this.parseUri(n),o=await this.transactions.search("Silo-Name",c.getAccessKey());if(o.length==0)throw new Error(`No data could be found for the Silo URI: ${n}`);const a=await this.transactions.get(o[0]);if(!a)throw new Error(`No data could be found for the Silo URI: ${n}`);const h=a.get("data",{decode:!0,string:!1});return this.crypto.decrypt(h,c.getEncryptionKey())}async readTransactionData(n,c){if(!c)throw new Error("No Silo URI specified");const o=await this.parseUri(c),a=n.get("data",{decode:!0,string:!1});return this.crypto.decrypt(a,o.getEncryptionKey())}async parseUri(n){const c=n.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!c)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");const o=c[1],a=Math.pow(2,parseInt(c[2])),h=await this.hash(i.stringToBuffer(o),a),f=i.bufferTob64(h.slice(0,15)),C=await this.hash(h.slice(16,31),1);return new r(n,f,C)}async hash(n,c){let o=await this.crypto.hash(n);for(let a=0;a<c-1;a++)o=await this.crypto.hash(o);return o}}Pe.default=t;class r{uri;accessKey;encryptionKey;constructor(n,c,o){this.uri=n,this.accessKey=c,this.encryptionKey=o}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}}return Pe.SiloResource=r,Pe}var Ve={},_t;function ur(){if(_t)return Ve;_t=1,Object.defineProperty(Ve,"__esModule",{value:!0});const i=tt(),t=Te();class r{api;constructor(n){this.api=n}async getTransactionOffset(n){const c=await this.api.get(`tx/${n}/offset`);if(c.status===200)return c.data;throw new Error(`Unable to get transaction offset: ${(0,i.getError)(c)}`)}async getChunk(n){const c=await this.api.get(`chunk/${n}`);if(c.status===200)return c.data;throw new Error(`Unable to get chunk: ${(0,i.getError)(c)}`)}async getChunkData(n){const c=await this.getChunk(n);return t.b64UrlToBuffer(c.chunk)}firstChunkOffset(n){return parseInt(n.offset)-parseInt(n.size)+1}async downloadChunkedData(n){const c=await this.getTransactionOffset(n),o=parseInt(c.size),h=parseInt(c.offset)-o+1,f=new Uint8Array(o);let C=0;for(;C<o;){this.api.config.logging&&console.log(`[chunk] ${C}/${o}`);let E;try{E=await this.getChunkData(h+C)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${h+C}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(E)f.set(E,C),C+=E.length;else throw new Error(`Couldn't complete data download at ${C}/${o}`)}return f}}return Ve.default=r,Ve}var Xe={},kt;function hr(){if(kt)return Xe;kt=1,Object.defineProperty(Xe,"__esModule",{value:!0});const i=tt();class t{api;network;static HASH_ENDPOINT="block/hash/";static HEIGHT_ENDPOINT="block/height/";constructor(s,n){this.api=s,this.network=n}async get(s){const n=await this.api.get(`${t.HASH_ENDPOINT}${s}`);if(n.status===200)return n.data;throw n.status===404?new i.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${n}`)}async getByHeight(s){const n=await this.api.get(`${t.HEIGHT_ENDPOINT}${s}`);if(n.status===200)return n.data;throw n.status===404?new i.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${n}`)}async getCurrent(){const{current:s}=await this.network.getInfo();return await this.get(s)}}return Xe.default=t,Xe}var Rt;function Qe(){if(Rt)return Fe;Rt=1,Object.defineProperty(Fe,"__esModule",{value:!0});const i=rr(),t=nr(),r=sr(),s=ir(),n=ar(),c=cr(),o=rt(),a=Te(),h=lr(),f=ur(),C=hr();class E{api;wallets;transactions;network;blocks;ar;silo;chunks;static init;static crypto=new r.default;static utils=a;constructor(A){this.api=new t.default(A),this.wallets=new c.default(this.api,E.crypto),this.chunks=new f.default(this.api),this.transactions=new n.default(this.api,E.crypto,this.chunks),this.silo=new h.default(this.api,this.crypto,this.transactions),this.network=new s.default(this.api),this.blocks=new C.default(this.api,this.network),this.ar=new i.default}get crypto(){return E.crypto}get utils(){return E.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(A,x){const _={};if(Object.assign(_,A),!A.data&&!(A.target&&A.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(A.owner==null&&x&&x!=="use_wallet"&&(_.owner=x.n),A.last_tx==null&&(_.last_tx=await this.transactions.getTransactionAnchor()),typeof A.data=="string"&&(A.data=a.stringToBuffer(A.data)),A.data instanceof ArrayBuffer&&(A.data=new Uint8Array(A.data)),A.data&&!(A.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(A.reward==null){const F=A.data?A.data.byteLength:0;_.reward=await this.transactions.getPrice(F,_.target)}_.data_root="",_.data_size=A.data?A.data.byteLength.toString():"0",_.data=A.data||new Uint8Array(0);const B=new o.default(_);return await B.getSignatureData(),B}async createSiloTransaction(A,x,_){const B={};if(Object.assign(B,A),!A.data)throw new Error("Silo transactions must have a 'data' value");if(!_)throw new Error("No Silo URI specified.");if(A.target||A.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(A.owner==null){if(!x||!x.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");B.owner=x.n}A.last_tx==null&&(B.last_tx=await this.transactions.getTransactionAnchor());const F=await this.silo.parseUri(_);if(typeof A.data=="string"){const W=await this.crypto.encrypt(a.stringToBuffer(A.data),F.getEncryptionKey());B.reward=await this.transactions.getPrice(W.byteLength),B.data=a.bufferTob64Url(W)}if(A.data instanceof Uint8Array){const W=await this.crypto.encrypt(A.data,F.getEncryptionKey());B.reward=await this.transactions.getPrice(W.byteLength),B.data=a.bufferTob64Url(W)}const D=new o.default(B);return D.addTag("Silo-Name",F.getAccessKey()),D.addTag("Silo-Version","0.1.0"),D}arql(A){return this.api.post("/arql",A).then(x=>x.data||[])}}return Fe.default=E,Fe}var Pt;function dr(){if(Pt)return Me;Pt=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=t;const i=Qe();async function t(s){if(Array.isArray(s)){const o=i.default.utils.concatBuffers([i.default.utils.stringToBuffer("list"),i.default.utils.stringToBuffer(s.length.toString())]);return await r(s,await i.default.crypto.hash(o,"SHA-384"))}const n=i.default.utils.concatBuffers([i.default.utils.stringToBuffer("blob"),i.default.utils.stringToBuffer(s.byteLength.toString())]),c=i.default.utils.concatBuffers([await i.default.crypto.hash(n,"SHA-384"),await i.default.crypto.hash(s,"SHA-384")]);return await i.default.crypto.hash(c,"SHA-384")}async function r(s,n){if(s.length<1)return n;const c=i.default.utils.concatBuffers([n,await t(s[0])]),o=await i.default.crypto.hash(c,"SHA-384");return await r(s.slice(1),o)}return Me}var Nt;function rt(){if(Nt)return Re;Nt=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.Tag=void 0;const i=Te(),t=dr(),r=Ft();class s{get(a,h){if(!Object.getOwnPropertyNames(this).includes(a))throw new Error(`Field "${a}" is not a property of the Arweave Transaction class.`);if(this[a]instanceof Uint8Array)return h&&h.decode&&h.string?i.bufferToString(this[a]):h&&h.decode&&!h.string?this[a]:i.bufferTob64Url(this[a]);if(this[a]instanceof Array){if(h?.decode!==void 0||h?.string!==void 0)throw a==="tags"&&console.warn(`Did you mean to use 'transaction["tags"]' ?`),new Error("Cannot decode or stringify an array.");return this[a]}return h&&h.decode==!0?h&&h.string?i.b64UrlToString(this[a]):i.b64UrlToBuffer(this[a]):this[a]}}class n extends s{name;value;constructor(a,h,f=!1){super(),this.name=a,this.value=h}}Re.Tag=n;class c extends s{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(a={}){super(),Object.assign(this,a),typeof this.data=="string"&&(this.data=i.b64UrlToBuffer(this.data)),a.tags&&(this.tags=a.tags.map(h=>new n(h.name,h.value)))}addTag(a,h){this.tags.push(new n(i.stringToB64Url(a),i.stringToB64Url(h)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:i.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(a){this.owner=a}setSignature({id:a,owner:h,reward:f,tags:C,signature:E}){this.id=a,this.owner=h,f&&(this.reward=f),C&&(this.tags=C),this.signature=E}async prepareChunks(a){!this.chunks&&a.byteLength>0&&(this.chunks=await(0,r.generateTransactionChunks)(a),this.data_root=i.bufferTob64Url(this.chunks.data_root)),!this.chunks&&a.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(a,h){if(!this.chunks)throw new Error("Chunks have not been prepared");const f=this.chunks.proofs[a],C=this.chunks.chunks[a];return{data_root:this.data_root,data_size:this.data_size,data_path:i.bufferTob64Url(f.proof),offset:f.offset.toString(),chunk:i.bufferTob64Url(h.slice(C.minByteRange,C.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let a=this.tags.reduce((f,C)=>i.concatBuffers([f,C.get("name",{decode:!0,string:!1}),C.get("value",{decode:!0,string:!1})]),new Uint8Array);return i.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),i.stringToBuffer(this.quantity),i.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),a]);case 2:this.data_root||await this.prepareChunks(this.data);const h=this.tags.map(f=>[f.get("name",{decode:!0,string:!1}),f.get("value",{decode:!0,string:!1})]);return await(0,t.default)([i.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),i.stringToBuffer(this.quantity),i.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),h,i.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}}return Re.default=c,Re}rt();class ge extends Error{constructor(t){super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,ge.prototype),t!==null&&typeof t=="object"&&(this.url=typeof t.url=="string"?t.url:"",this.status=typeof t.status=="number"?t.status:0,this.isAbort=!!t.isAbort,this.originalError=t.originalError,t.response!==null&&typeof t.response=="object"?this.response=t.response:t.data!==null&&typeof t.data=="object"?this.response=t.data:this.response={}),this.originalError||t instanceof ge||(this.originalError=t),typeof DOMException<"u"&&t instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=this.response?.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":this.originalError?.cause?.message?.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong."),this.cause=this.originalError}get data(){return this.response}toJSON(){return{...this}}}const Ze=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function fr(i,t){const r={};if(typeof i!="string")return r;const s=Object.assign({},{}).decode||gr;let n=0;for(;n<i.length;){const c=i.indexOf("=",n);if(c===-1)break;let o=i.indexOf(";",n);if(o===-1)o=i.length;else if(o<c){n=i.lastIndexOf(";",c-1)+1;continue}const a=i.slice(n,c).trim();if(r[a]===void 0){let h=i.slice(c+1,o).trim();h.charCodeAt(0)===34&&(h=h.slice(1,-1));try{r[a]=s(h)}catch{r[a]=h}}n=o+1}return r}function It(i,t,r){const s=Object.assign({},r||{}),n=s.encode||pr;if(!Ze.test(i))throw new TypeError("argument name is invalid");const c=n(t);if(c&&!Ze.test(c))throw new TypeError("argument val is invalid");let o=i+"="+c;if(s.maxAge!=null){const a=s.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(a)}if(s.domain){if(!Ze.test(s.domain))throw new TypeError("option domain is invalid");o+="; Domain="+s.domain}if(s.path){if(!Ze.test(s.path))throw new TypeError("option path is invalid");o+="; Path="+s.path}if(s.expires){if(!function(h){return Object.prototype.toString.call(h)==="[object Date]"||h instanceof Date}(s.expires)||isNaN(s.expires.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(o+="; HttpOnly"),s.secure&&(o+="; Secure"),s.priority)switch(typeof s.priority=="string"?s.priority.toLowerCase():s.priority){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o}function gr(i){return i.indexOf("%")!==-1?decodeURIComponent(i):i}function pr(i){return encodeURIComponent(i)}const wr=typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal;let Wt;function xe(i){if(i)try{const t=decodeURIComponent(Wt(i.split(".")[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(t)||{}}catch{}return{}}function Kt(i,t=0){let r=xe(i);return!(Object.keys(r).length>0&&(!r.exp||r.exp-t>Date.now()/1e3))}Wt=typeof atob!="function"||wr?i=>{let t=String(i).replace(/=+$/,"");if(t.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,s,n=0,c=0,o="";s=t.charAt(c++);~s&&(r=n%4?64*r+s:s,n++%4)?o+=String.fromCharCode(255&r>>(-2*n&6)):0)s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(s);return o}:atob;const xt="pb_auth";class ht{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get record(){return this.baseModel}get model(){return this.baseModel}get isValid(){return!Kt(this.token)}get isSuperuser(){let t=xe(this.token);return t.type=="auth"&&(this.record?.collectionName=="_superusers"||!this.record?.collectionName&&t.collectionId=="pbc_3142635823")}get isAdmin(){return console.warn("Please replace pb.authStore.isAdmin with pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),this.isSuperuser}get isAuthRecord(){return console.warn("Please replace pb.authStore.isAuthRecord with !pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),xe(this.token).type=="auth"&&!this.isSuperuser}save(t,r){this.baseToken=t||"",this.baseModel=r||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(t,r=xt){const s=fr(t||"")[r]||"";let n={};try{n=JSON.parse(s),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch{}this.save(n.token||"",n.record||n.model||null)}exportToCookie(t,r=xt){const s={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=xe(this.token);s.expires=n?.exp?new Date(1e3*n.exp):new Date("1970-01-01"),t=Object.assign({},s,t);const c={token:this.token,record:this.record?JSON.parse(JSON.stringify(this.record)):null};let o=It(r,JSON.stringify(c),t);const a=typeof Blob<"u"?new Blob([o]).size:o.length;if(c.record&&a>4096){c.record={id:c.record?.id,email:c.record?.email};const h=["collectionId","collectionName","verified"];for(const f in this.record)h.includes(f)&&(c.record[f]=this.record[f]);o=It(r,JSON.stringify(c),t)}return o}onChange(t,r=!1){return this._onChangeCallbacks.push(t),r&&t(this.token,this.record),()=>{for(let s=this._onChangeCallbacks.length-1;s>=0;s--)if(this._onChangeCallbacks[s]==t)return delete this._onChangeCallbacks[s],void this._onChangeCallbacks.splice(s,1)}}triggerChange(){for(const t of this._onChangeCallbacks)t&&t(this.token,this.record)}}class yr extends ht{constructor(t="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get record(){const t=this._storageGet(this.storageKey)||{};return t.record||t.model||null}get model(){return this.record}save(t,r){this._storageSet(this.storageKey,{token:t,record:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(t){if(typeof window<"u"&&window?.localStorage){const r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch{return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window<"u"&&window?.localStorage){let s=r;typeof r!="string"&&(s=JSON.stringify(r)),window.localStorage.setItem(t,s)}else this.storageFallback[t]=r}_storageRemove(t){typeof window<"u"&&window?.localStorage&&window.localStorage?.removeItem(t),delete this.storageFallback[t]}_bindStorageEvent(){typeof window<"u"&&window?.localStorage&&window.addEventListener&&window.addEventListener("storage",t=>{if(t.key!=this.storageKey)return;const r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.record||r.model||null)})}}class Oe{constructor(t){this.client=t}}class mr extends Oe{async getAll(t){return t=Object.assign({method:"GET"},t),this.client.send("/api/settings",t)}async update(t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send("/api/settings",r)}async testS3(t="storage",r){return r=Object.assign({method:"POST",body:{filesystem:t}},r),this.client.send("/api/settings/test/s3",r).then(()=>!0)}async testEmail(t,r,s,n){return n=Object.assign({method:"POST",body:{email:r,template:s,collection:t}},n),this.client.send("/api/settings/test/email",n).then(()=>!0)}async generateAppleClientSecret(t,r,s,n,c,o){return o=Object.assign({method:"POST",body:{clientId:t,teamId:r,keyId:s,privateKey:n,duration:c}},o),this.client.send("/api/settings/apple/generate-client-secret",o)}}const br=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function dt(i){if(i){i.query=i.query||{};for(let t in i)br.includes(t)||(i.query[t]=i[t],delete i[t])}}function Ht(i){const t=[];for(const r in i){const s=encodeURIComponent(r),n=Array.isArray(i[r])?i[r]:[i[r]];for(let c of n)c=vr(c),c!==null&&t.push(s+"="+c)}return t.join("&")}function vr(i){return i==null?null:i instanceof Date?encodeURIComponent(i.toISOString().replace("T"," ")):encodeURIComponent(typeof i=="object"?JSON.stringify(i):i)}class Gt extends Oe{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(t,r,s){if(!t)throw new Error("topic must be set.");let n=t;if(s){dt(s=Object.assign({},s));const o="options="+encodeURIComponent(JSON.stringify({query:s.query,headers:s.headers}));n+=(n.includes("?")?"&":"?")+o}const c=function(o){const a=o;let h;try{h=JSON.parse(a?.data)}catch{}r(h||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(c),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():this.eventSource?.addEventListener(n,c):await this.connect(),async()=>this.unsubscribeByTopicAndListener(t,c)}async unsubscribe(t){let r=!1;if(t){const s=this.getSubscriptionsByTopic(t);for(let n in s)if(this.hasSubscriptionListeners(n)){for(let c of this.subscriptions[n])this.eventSource?.removeEventListener(n,c);delete this.subscriptions[n],r||(r=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(t){let r=!1;for(let s in this.subscriptions)if((s+"?").startsWith(t)){r=!0;for(let n of this.subscriptions[s])this.eventSource?.removeEventListener(s,n);delete this.subscriptions[s]}r&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(t,r){let s=!1;const n=this.getSubscriptionsByTopic(t);for(let c in n){if(!Array.isArray(this.subscriptions[c])||!this.subscriptions[c].length)continue;let o=!1;for(let a=this.subscriptions[c].length-1;a>=0;a--)this.subscriptions[c][a]===r&&(o=!0,delete this.subscriptions[c][a],this.subscriptions[c].splice(a,1),this.eventSource?.removeEventListener(c,r));o&&(this.subscriptions[c].length||delete this.subscriptions[c],s||this.hasSubscriptionListeners(c)||(s=!0))}this.hasSubscriptionListeners()?s&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(t){if(this.subscriptions=this.subscriptions||{},t)return!!this.subscriptions[t]?.length;for(let r in this.subscriptions)if(this.subscriptions[r]?.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(t=>{if(!t?.isAbort)throw t})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(t){const r={};t=t.includes("?")?t:t+"?";for(let s in this.subscriptions)(s+"?").startsWith(t)&&(r[s]=this.subscriptions[s]);return r}getNonEmptySubscriptionKeys(){const t=[];for(let r in this.subscriptions)this.subscriptions[r].length&&t.push(r);return t}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let t in this.subscriptions)for(let r of this.subscriptions[t])this.eventSource.addEventListener(t,r)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let t in this.subscriptions)for(let r of this.subscriptions[t])this.eventSource.removeEventListener(t,r)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((t,r)=>{this.pendingConnects.push({resolve:t,reject:r}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildURL("/api/realtime")),this.eventSource.onerror=t=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",t=>{const r=t;this.clientId=r?.lastEventId,this.submitSubscriptions().then(async()=>{let s=3;for(;this.hasUnsentSubscriptions()&&s>0;)s--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const s=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in s)for(let c of s[n])c(t)}).catch(s=>{this.clientId="",this.connectErrorHandler(s)})})}hasUnsentSubscriptions(){const t=this.getNonEmptySubscriptionKeys();if(t.length!=this.lastSentSubscriptions.length)return!0;for(const r of t)if(!this.lastSentSubscriptions.includes(r))return!0;return!1}connectErrorHandler(t){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let s of this.pendingConnects)s.reject(new ge(t));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const r=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},r)}disconnect(t=!1){if(this.clientId&&this.onDisconnect&&this.onDisconnect(Object.keys(this.subscriptions)),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),this.eventSource?.close(),this.eventSource=null,this.clientId="",!t){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}}class Jt extends Oe{decode(t){return t}async getFullList(t,r){if(typeof t=="number")return this._getFullList(t,r);let s=500;return(r=Object.assign({},t,r)).batch&&(s=r.batch,delete r.batch),this._getFullList(s,r)}async getList(t=1,r=30,s){return(s=Object.assign({method:"GET"},s)).query=Object.assign({page:t,perPage:r},s.query),this.client.send(this.baseCrudPath,s).then(n=>(n.items=n.items?.map(c=>this.decode(c))||[],n))}async getFirstListItem(t,r){return(r=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+t},r)).query=Object.assign({filter:t,skipTotal:1},r.query),this.getList(1,1,r).then(s=>{if(!s?.items?.length)throw new ge({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return s.items[0]})}async getOne(t,r){if(!t)throw new ge({url:this.client.buildURL(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return r=Object.assign({method:"GET"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(t),r).then(s=>this.decode(s))}async create(t,r){return r=Object.assign({method:"POST",body:t},r),this.client.send(this.baseCrudPath,r).then(s=>this.decode(s))}async update(t,r,s){return s=Object.assign({method:"PATCH",body:r},s),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(t),s).then(n=>this.decode(n))}async delete(t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(t),r).then(()=>!0)}_getFullList(t=500,r){(r=r||{}).query=Object.assign({skipTotal:1},r.query);let s=[],n=async c=>this.getList(c,t||500,r).then(o=>{const a=o.items;return s=s.concat(a),a.length==o.perPage?n(c+1):s});return n(1)}}function _e(i,t,r,s){const n=s!==void 0;return n||r!==void 0?n?(console.warn(i),t.body=Object.assign({},t.body,r),t.query=Object.assign({},t.query,s),t):Object.assign(t,r):t}function at(i){i._resetAutoRefresh?.()}class Sr extends Jt{constructor(t,r){super(t),this.collectionIdOrName=r}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}get isSuperusers(){return this.collectionIdOrName=="_superusers"||this.collectionIdOrName=="_pbc_2773867675"}async subscribe(t,r,s){if(!t)throw new Error("Missing topic.");if(!r)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+t,r,s)}async unsubscribe(t){return t?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+t):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(t,r){if(typeof t=="number")return super.getFullList(t,r);const s=Object.assign({},t,r);return super.getFullList(s)}async getList(t=1,r=30,s){return super.getList(t,r,s)}async getFirstListItem(t,r){return super.getFirstListItem(t,r)}async getOne(t,r){return super.getOne(t,r)}async create(t,r){return super.create(t,r)}async update(t,r,s){return super.update(t,r,s).then(n=>{if(this.client.authStore.record?.id===n?.id&&(this.client.authStore.record?.collectionId===this.collectionIdOrName||this.client.authStore.record?.collectionName===this.collectionIdOrName)){let c=Object.assign({},this.client.authStore.record.expand),o=Object.assign({},this.client.authStore.record,n);c&&(o.expand=Object.assign(c,n.expand)),this.client.authStore.save(this.client.authStore.token,o)}return n})}async delete(t,r){return super.delete(t,r).then(s=>(!s||this.client.authStore.record?.id!==t||this.client.authStore.record?.collectionId!==this.collectionIdOrName&&this.client.authStore.record?.collectionName!==this.collectionIdOrName||this.client.authStore.clear(),s))}authResponse(t){const r=this.decode(t?.record||{});return this.client.authStore.save(t?.token,r),Object.assign({},t,{token:t?.token||"",record:r})}async listAuthMethods(t){return t=Object.assign({method:"GET",fields:"mfa,otp,password,oauth2"},t),this.client.send(this.baseCollectionPath+"/auth-methods",t)}async authWithPassword(t,r,s){let n;s=Object.assign({method:"POST",body:{identity:t,password:r}},s),this.isSuperusers&&(n=s.autoRefreshThreshold,delete s.autoRefreshThreshold,s.autoRefresh||at(this.client));let c=await this.client.send(this.baseCollectionPath+"/auth-with-password",s);return c=this.authResponse(c),n&&this.isSuperusers&&function(a,h,f,C){at(a);const E=a.beforeSend,I=a.authStore.record,A=a.authStore.onChange((x,_)=>{(!x||_?.id!=I?.id||(_?.collectionId||I?.collectionId)&&_?.collectionId!=I?.collectionId)&&at(a)});a._resetAutoRefresh=function(){A(),a.beforeSend=E,delete a._resetAutoRefresh},a.beforeSend=async(x,_)=>{const B=a.authStore.token;if(_.query?.autoRefresh)return E?E(x,_):{url:x,sendOptions:_};let F=a.authStore.isValid;if(F&&Kt(a.authStore.token,h))try{await f()}catch{F=!1}F||await C();const D=_.headers||{};for(let W in D)if(W.toLowerCase()=="authorization"&&B==D[W]&&a.authStore.token){D[W]=a.authStore.token;break}return _.headers=D,E?E(x,_):{url:x,sendOptions:_}}}(this.client,n,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(t,r,Object.assign({autoRefresh:!0},s))),c}async authWithOAuth2Code(t,r,s,n,c,o,a){let h={method:"POST",body:{provider:t,code:r,codeVerifier:s,redirectURL:n,createData:c}};return h=_e("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, options?).",h,o,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",h).then(f=>this.authResponse(f))}authWithOAuth2(...t){if(t.length>1||typeof t?.[0]=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code(t?.[0]||"",t?.[1]||"",t?.[2]||"",t?.[3]||"",t?.[4]||{},t?.[5]||{},t?.[6]||{});const r=t?.[0]||{};let s=null;r.urlCallback||(s=Ut(void 0));const n=new Gt(this.client);function c(){s?.close(),n.unsubscribe()}const o={},a=r.requestKey;return a&&(o.requestKey=a),this.listAuthMethods(o).then(h=>{const f=h.oauth2.providers.find(I=>I.name===r.provider);if(!f)throw new ge(new Error(`Missing or invalid provider "${r.provider}".`));const C=this.client.buildURL("/api/oauth2-redirect"),E=a?this.client.cancelControllers?.[a]:void 0;return E&&(E.signal.onabort=()=>{c()}),new Promise(async(I,A)=>{try{await n.subscribe("@oauth2",async F=>{const D=n.clientId;try{if(!F.state||D!==F.state)throw new Error("State parameters don't match.");if(F.error||!F.code)throw new Error("OAuth2 redirect error or missing code: "+F.error);const W=Object.assign({},r);delete W.provider,delete W.scopes,delete W.createData,delete W.urlCallback,E?.signal?.onabort&&(E.signal.onabort=null);const te=await this.authWithOAuth2Code(f.name,F.code,f.codeVerifier,C,r.createData,W);I(te)}catch(W){A(new ge(W))}c()});const x={state:n.clientId};r.scopes?.length&&(x.scope=r.scopes.join(" "));const _=this._replaceQueryParams(f.authURL+C,x);await(r.urlCallback||function(F){s?s.location.href=F:s=Ut(F)})(_)}catch(x){c(),A(new ge(x))}})}).catch(h=>{throw c(),h})}async authRefresh(t,r){let s={method:"POST"};return s=_e("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",s,t,r),this.client.send(this.baseCollectionPath+"/auth-refresh",s).then(n=>this.authResponse(n))}async requestPasswordReset(t,r,s){let n={method:"POST",body:{email:t}};return n=_e("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(t,r,s,n,c){let o={method:"POST",body:{token:t,password:r,passwordConfirm:s}};return o=_e("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",o,n,c),this.client.send(this.baseCollectionPath+"/confirm-password-reset",o).then(()=>!0)}async requestVerification(t,r,s){let n={method:"POST",body:{email:t}};return n=_e("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(t,r,s){let n={method:"POST",body:{token:t}};return n=_e("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>{const c=xe(t),o=this.client.authStore.record;return o&&!o.verified&&o.id===c.id&&o.collectionId===c.collectionId&&(o.verified=!0,this.client.authStore.save(this.client.authStore.token,o)),!0})}async requestEmailChange(t,r,s){let n={method:"POST",body:{newEmail:t}};return n=_e("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(t,r,s,n){let c={method:"POST",body:{token:t,password:r}};return c=_e("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",c,s,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",c).then(()=>{const o=xe(t),a=this.client.authStore.record;return a&&a.id===o.id&&a.collectionId===o.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(t,r){return this.client.collection("_externalAuths").getFullList(Object.assign({},r,{filter:this.client.filter("recordRef = {:id}",{id:t})}))}async unlinkExternalAuth(t,r,s){const n=await this.client.collection("_externalAuths").getFirstListItem(this.client.filter("recordRef = {:recordId} && provider = {:provider}",{recordId:t,provider:r}));return this.client.collection("_externalAuths").delete(n.id,s).then(()=>!0)}async requestOTP(t,r){return r=Object.assign({method:"POST",body:{email:t}},r),this.client.send(this.baseCollectionPath+"/request-otp",r)}async authWithOTP(t,r,s){return s=Object.assign({method:"POST",body:{otpId:t,password:r}},s),this.client.send(this.baseCollectionPath+"/auth-with-otp",s).then(n=>this.authResponse(n))}async impersonate(t,r,s){(s=Object.assign({method:"POST",body:{duration:r}},s)).headers=s.headers||{},s.headers.Authorization||(s.headers.Authorization=this.client.authStore.token);const n=new zt(this.client.baseURL,new ht,this.client.lang),c=await n.send(this.baseCollectionPath+"/impersonate/"+encodeURIComponent(t),s);return n.authStore.save(c?.token,this.decode(c?.record||{})),n}_replaceQueryParams(t,r={}){let s=t,n="";t.indexOf("?")>=0&&(s=t.substring(0,t.indexOf("?")),n=t.substring(t.indexOf("?")+1));const c={},o=n.split("&");for(const a of o){if(a=="")continue;const h=a.split("=");c[decodeURIComponent(h[0].replace(/\+/g," "))]=decodeURIComponent((h[1]||"").replace(/\+/g," "))}for(let a in r)r.hasOwnProperty(a)&&(r[a]==null?delete c[a]:c[a]=r[a]);n="";for(let a in c)c.hasOwnProperty(a)&&(n!=""&&(n+="&"),n+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(c[a].replace(/%20/g,"+")));return n!=""?s+"?"+n:s}}function Ut(i){if(typeof window>"u"||!window?.open)throw new ge(new Error("Not in a browser context - please pass a custom urlCallback function."));let t=1024,r=768,s=window.innerWidth,n=window.innerHeight;t=t>s?s:t,r=r>n?n:r;let c=s/2-t/2,o=n/2-r/2;return window.open(i,"popup_window","width="+t+",height="+r+",top="+o+",left="+c+",resizable,menubar=no")}class Ar extends Jt{get baseCrudPath(){return"/api/collections"}async import(t,r=!1,s){return s=Object.assign({method:"PUT",body:{collections:t,deleteMissing:r}},s),this.client.send(this.baseCrudPath+"/import",s).then(()=>!0)}async getScaffolds(t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/meta/scaffolds",t)}async truncate(t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(t)+"/truncate",r).then(()=>!0)}}class Cr extends Oe{async getList(t=1,r=30,s){return(s=Object.assign({method:"GET"},s)).query=Object.assign({page:t,perPage:r},s.query),this.client.send("/api/logs",s)}async getOne(t,r){if(!t)throw new ge({url:this.client.buildURL("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return r=Object.assign({method:"GET"},r),this.client.send("/api/logs/"+encodeURIComponent(t),r)}async getStats(t){return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/stats",t)}}class Er extends Oe{async check(t){return t=Object.assign({method:"GET"},t),this.client.send("/api/health",t)}}class Tr extends Oe{getUrl(t,r,s={}){return console.warn("Please replace pb.files.getUrl() with pb.files.getURL()"),this.getURL(t,r,s)}getURL(t,r,s={}){if(!r||!t?.id||!t?.collectionId&&!t?.collectionName)return"";const n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(t.collectionId||t.collectionName)),n.push(encodeURIComponent(t.id)),n.push(encodeURIComponent(r));let c=this.client.buildURL(n.join("/"));if(Object.keys(s).length){s.download===!1&&delete s.download;const o=new URLSearchParams(s);c+=(c.includes("?")?"&":"?")+o}return c}async getToken(t){return t=Object.assign({method:"POST"},t),this.client.send("/api/files/token",t).then(r=>r?.token||"")}}class Or extends Oe{async getFullList(t){return t=Object.assign({method:"GET"},t),this.client.send("/api/backups",t)}async create(t,r){return r=Object.assign({method:"POST",body:{name:t}},r),this.client.send("/api/backups",r).then(()=>!0)}async upload(t,r){return r=Object.assign({method:"POST",body:t},r),this.client.send("/api/backups/upload",r).then(()=>!0)}async delete(t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(`/api/backups/${encodeURIComponent(t)}`,r).then(()=>!0)}async restore(t,r){return r=Object.assign({method:"POST"},r),this.client.send(`/api/backups/${encodeURIComponent(t)}/restore`,r).then(()=>!0)}getDownloadUrl(t,r){return console.warn("Please replace pb.backups.getDownloadUrl() with pb.backups.getDownloadURL()"),this.getDownloadURL(t,r)}getDownloadURL(t,r){return this.client.buildURL(`/api/backups/${encodeURIComponent(r)}?token=${encodeURIComponent(t)}`)}}class _r extends Oe{async getFullList(t){return t=Object.assign({method:"GET"},t),this.client.send("/api/crons",t)}async run(t,r){return r=Object.assign({method:"POST"},r),this.client.send(`/api/crons/${encodeURIComponent(t)}`,r).then(()=>!0)}}function ct(i){return typeof Blob<"u"&&i instanceof Blob||typeof File<"u"&&i instanceof File||i!==null&&typeof i=="object"&&i.uri&&(typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal)}function lt(i){return i&&(i.constructor.name==="FormData"||typeof FormData<"u"&&i instanceof FormData)}function Lt(i){for(const t in i){const r=Array.isArray(i[t])?i[t]:[i[t]];for(const s of r)if(ct(s))return!0}return!1}const kr=/^[\-\.\d]+$/;function Dt(i){if(typeof i!="string")return i;if(i=="true")return!0;if(i=="false")return!1;if((i[0]==="-"||i[0]>="0"&&i[0]<="9")&&kr.test(i)){let t=+i;if(""+t===i)return t}return i}class Rr extends Oe{constructor(){super(...arguments),this.requests=[],this.subs={}}collection(t){return this.subs[t]||(this.subs[t]=new Pr(this.requests,t)),this.subs[t]}async send(t){const r=new FormData,s=[];for(let n=0;n<this.requests.length;n++){const c=this.requests[n];if(s.push({method:c.method,url:c.url,headers:c.headers,body:c.json}),c.files)for(let o in c.files){const a=c.files[o]||[];for(let h of a)r.append("requests."+n+"."+o,h)}}return r.append("@jsonPayload",JSON.stringify({requests:s})),t=Object.assign({method:"POST",body:r},t),this.client.send("/api/batch",t)}}class Pr{constructor(t,r){this.requests=[],this.requests=t,this.collectionIdOrName=r}upsert(t,r){r=Object.assign({body:t||{}},r);const s={method:"PUT",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(s,r),this.requests.push(s)}create(t,r){r=Object.assign({body:t||{}},r);const s={method:"POST",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(s,r),this.requests.push(s)}update(t,r,s){s=Object.assign({body:r||{}},s);const n={method:"PATCH",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(t)};this.prepareRequest(n,s),this.requests.push(n)}delete(t,r){r=Object.assign({},r);const s={method:"DELETE",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(t)};this.prepareRequest(s,r),this.requests.push(s)}prepareRequest(t,r){if(dt(r),t.headers=r.headers,t.json={},t.files={},r.query!==void 0){const n=Ht(r.query);n&&(t.url+=(t.url.includes("?")?"&":"?")+n)}let s=r.body;lt(s)&&(s=function(c){let o={};return c.forEach((a,h)=>{if(h==="@jsonPayload"&&typeof a=="string")try{let f=JSON.parse(a);Object.assign(o,f)}catch(f){console.warn("@jsonPayload error:",f)}else o[h]!==void 0?(Array.isArray(o[h])||(o[h]=[o[h]]),o[h].push(Dt(a))):o[h]=Dt(a)}),o}(s));for(const n in s){const c=s[n];if(ct(c))t.files[n]=t.files[n]||[],t.files[n].push(c);else if(Array.isArray(c)){const o=[],a=[];for(const h of c)ct(h)?o.push(h):a.push(h);if(o.length>0&&o.length==c.length){t.files[n]=t.files[n]||[];for(let h of o)t.files[n].push(h)}else if(t.json[n]=a,o.length>0){let h=n;n.startsWith("+")||n.endsWith("+")||(h+="+"),t.files[h]=t.files[h]||[];for(let f of o)t.files[h].push(f)}}else t.json[n]=c}}}class zt{get baseUrl(){return this.baseURL}set baseUrl(t){this.baseURL=t}constructor(t="/",r,s="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseURL=t,this.lang=s,r?this.authStore=r:typeof window<"u"&&window.Deno?this.authStore=new ht:this.authStore=new yr,this.collections=new Ar(this),this.files=new Tr(this),this.logs=new Cr(this),this.settings=new mr(this),this.realtime=new Gt(this),this.health=new Er(this),this.backups=new Or(this),this.crons=new _r(this)}get admins(){return this.collection("_superusers")}createBatch(){return new Rr(this)}collection(t){return this.recordServices[t]||(this.recordServices[t]=new Sr(this,t)),this.recordServices[t]}autoCancellation(t){return this.enableAutoCancellation=!!t,this}cancelRequest(t){return this.cancelControllers[t]&&(this.cancelControllers[t].abort(),delete this.cancelControllers[t]),this}cancelAllRequests(){for(let t in this.cancelControllers)this.cancelControllers[t].abort();return this.cancelControllers={},this}filter(t,r){if(!r)return t;for(let s in r){let n=r[s];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}t=t.replaceAll("{:"+s+"}",n)}return t}getFileUrl(t,r,s={}){return console.warn("Please replace pb.getFileUrl() with pb.files.getURL()"),this.files.getURL(t,r,s)}buildUrl(t){return console.warn("Please replace pb.buildUrl() with pb.buildURL()"),this.buildURL(t)}buildURL(t){let r=this.baseURL;return typeof window>"u"||!window.location||r.startsWith("https://")||r.startsWith("http://")||(r=window.location.origin?.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseURL.startsWith("/")||(r+=window.location.pathname||"/",r+=r.endsWith("/")?"":"/"),r+=this.baseURL),t&&(r+=r.endsWith("/")?"":"/",r+=t.startsWith("/")?t.substring(1):t),r}async send(t,r){r=this.initSendOptions(t,r);let s=this.buildURL(t);if(this.beforeSend){const n=Object.assign({},await this.beforeSend(s,r));n.url!==void 0||n.options!==void 0?(s=n.url||s,r=n.options||r):Object.keys(n).length&&(r=n,console?.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(r.query!==void 0){const n=Ht(r.query);n&&(s+=(s.includes("?")?"&":"?")+n),delete r.query}return this.getHeader(r.headers,"Content-Type")=="application/json"&&r.body&&typeof r.body!="string"&&(r.body=JSON.stringify(r.body)),(r.fetch||fetch)(s,r).then(async n=>{let c={};try{c=await n.json()}catch{}if(this.afterSend&&(c=await this.afterSend(n,c,r)),n.status>=400)throw new ge({url:n.url,status:n.status,data:c});return c}).catch(n=>{throw new ge(n)})}initSendOptions(t,r){if((r=Object.assign({method:"GET"},r)).body=function(n){if(typeof FormData>"u"||n===void 0||typeof n!="object"||n===null||lt(n)||!Lt(n))return n;const c=new FormData;for(const o in n){const a=n[o];if(a!==void 0)if(typeof a!="object"||Lt({data:a})){const h=Array.isArray(a)?a:[a];for(let f of h)c.append(o,f)}else{let h={};h[o]=a,c.append("@jsonPayload",JSON.stringify(h))}}return c}(r.body),dt(r),r.query=Object.assign({},r.params,r.query),r.requestKey===void 0&&(r.$autoCancel===!1||r.query.$autoCancel===!1?r.requestKey=null:(r.$cancelKey||r.query.$cancelKey)&&(r.requestKey=r.$cancelKey||r.query.$cancelKey)),delete r.$autoCancel,delete r.query.$autoCancel,delete r.$cancelKey,delete r.query.$cancelKey,this.getHeader(r.headers,"Content-Type")!==null||lt(r.body)||(r.headers=Object.assign({},r.headers,{"Content-Type":"application/json"})),this.getHeader(r.headers,"Accept-Language")===null&&(r.headers=Object.assign({},r.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(r.headers,"Authorization")===null&&(r.headers=Object.assign({},r.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&r.requestKey!==null){const s=r.requestKey||(r.method||"GET")+t;delete r.requestKey,this.cancelRequest(s);const n=new AbortController;this.cancelControllers[s]=n,r.signal=n.signal}return r}getHeader(t,r){t=t||{},r=r.toLowerCase();for(let s in t)if(s.toLowerCase()==r)return t[s];return null}}var ke={},je={},Bt;function Nr(){if(Bt)return je;Bt=1,Object.defineProperty(je,"__esModule",{value:!0}),je.getDefaultConfig=void 0;const i=(s,n)=>{const c=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,o=n.split("."),a=o[o.length-1],h=["localhost","[::1]"];return h.includes(n)||s=="file"||h.includes(a)||!!n.match(c)||!!a.match(c)},t=s=>{const n=s.charAt(0)==="[",c=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return!!s.match(c)||n},r=(s,n)=>{if(i(s,n))return{protocol:"https",host:"arweave.net",port:443};if(!t(n)){let c=n.split(".");if(c.length>=3){c.shift();const o=c.join(".");return{protocol:s,host:o}}}return{protocol:s,host:n}};return je.getDefaultConfig=r,je}var qt;function Ir(){return qt||(qt=1,function(i){var t=ke&&ke.__createBinding||(Object.create?function(c,o,a,h){h===void 0&&(h=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(c,h,f)}:function(c,o,a,h){h===void 0&&(h=a),c[h]=o[a]}),r=ke&&ke.__exportStar||function(c,o){for(var a in c)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,c,a)};Object.defineProperty(i,"__esModule",{value:!0});const s=Qe(),n=Nr();s.default.init=function(c={}){const o={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return new s.default({...c,...o});const a=location.protocol.replace(":",""),h=location.hostname,f=location.port?parseInt(location.port):a=="https"?443:80,C=(0,n.getDefaultConfig)(a,h),E=c.protocol||C.protocol,I=c.host||C.host,A=c.port||C.port||f;return new s.default({...c,host:I,protocol:E,port:A})},typeof globalThis=="object"?globalThis.Arweave=s.default:typeof self=="object"&&(self.Arweave=s.default),r(Qe(),i),i.default=s.default}(ke)),ke}Ir();exports.WAuthProviders=void 0;(function(i){i.Google="google",i.Github="github",i.Discord="discord"})(exports.WAuthProviders||(exports.WAuthProviders={}));class Ie{static devUrl="http://localhost:8090";static devBackendUrl="http://localhost:8091";static prodUrl="https://wauth.arnode.asia";static prodBackendUrl="https://wauth-backend.arnode.asia";pb;authData;wallet;authRecord;backendUrl;authDataListeners=[];constructor({dev:t,url:r,backendUrl:s}){t==null&&(t=process.env.NODE_ENV==="development"),this.pb=new zt(r||(t?Ie.devUrl:Ie.prodUrl)),this.backendUrl=s||(t?Ie.devBackendUrl:Ie.prodBackendUrl),this.authData=null,this.wallet=null,this.authRecord=null,this.pb.authStore.onChange(async(n,c)=>{!c||!localStorage.getItem("pocketbase_auth")||(console.log("[wauth] auth updated",c?.email),this.authRecord=c,this.authData=this.getAuthData(),this.wallet=await this.getWallet(),this.authDataListeners.forEach(o=>o(this.getAuthData())))},!0)}onAuthDataChange(t){this.authDataListeners.push(t),this.authData&&t(this.authData)}async connect({provider:t}){if(!Object.values(exports.WAuthProviders).includes(t))throw new Error(`Invalid provider: ${t}. Valid providers are: ${Object.values(exports.WAuthProviders).join(", ")}`);try{this.authData=await this.pb.collection("users").authWithOAuth2({provider:t}),this.authDataListeners.forEach(r=>r(this.getAuthData()))}catch(r){return console.error("[wauth] error logging in,",r),null}if(!this.isLoggedIn())return null;try{if(this.wallet=await this.getWallet(),!this.wallet){if(console.log("[wauth] no wallet found, creating one"),await this.pb.collection("wallets").create({}),this.wallet=await this.getWallet(),!this.wallet)throw new Error("Failed to create wallet");console.log("[wauth] wallet created",this.wallet)}}catch(r){console.error("[wauth]",r)}return this.getAuthData()}isLoggedIn(){return this.pb.authStore.isValid}async getActiveAddress(){if(!this.isLoggedIn())throw new Error("Not logged in");return this.wallet||(this.wallet=await this.getWallet()),this.wallet?.address||""}async getPermissions(){return["ACCESS_ADDRESS","SIGN_TRANSACTION"]}async getWalletNames(){return{[await this.getActiveAddress()]:"WAuth"}}async getArweaveConfig(){return{host:"arweave.net",port:443,protocol:"https"}}getAuthData(){return this.isLoggedIn()?this.authData:null}async getWallet(){if(!this.isLoggedIn())return null;try{if(this.wallet=await this.pb.collection("wallets").getFirstListItem(`user.id = "${this.pb.authStore.record?.id}"`),console.log("[wauth] wallet",this.wallet?.address),!this.wallet){if(console.log("[wauth] no wallet found, creating one"),await this.pb.collection("wallets").create({}),this.wallet=await this.pb.collection("wallets").getFirstListItem(`user.id = "${this.pb.authStore.record?.id}"`),!this.wallet)throw new Error("Failed to create wallet");console.log("[wauth] wallet created",this.wallet)}return this.wallet}catch(t){return`${t}`.includes("autocancelled")||console.info("[wauth] error fetching wallet",t),null}}getAuthRecord(){return this.isLoggedIn()?this.authRecord:null}pocketbase(){return this.pb}logout(){this.authData=null,this.wallet=null,this.authRecord=null,this.pb.authStore.clear()}}class xr{id="wauth";name="WAuth";description="WAuth";theme="25,25,25";logo="94R-dRRMdFerUnt8HuQzWT48ktgKsgjQ0uH6zlMFXVw";url="https://subspace.ar.io";walletRef;provider;addressListeners=[];authData;authDataListeners=[];logos={[exports.WAuthProviders.Google]:"mc-lqDefUJZdDSOOqepLICrfEoQCACnS51tB3kKqvlk",[exports.WAuthProviders.Github]:"2bcLcWjuuRFDqFHlUvgvX2MzA2hOlZL1ED-T8OFBwCY",[exports.WAuthProviders.Discord]:"i4Lw4kXr5t57p8E1oOVGMO4vR35TlYsaJ9XYbMMVd8I"};constructor({provider:t}){this.provider=t,this.id=this.id+"-"+this.provider,this.name=`${this.provider.charAt(0).toUpperCase()+this.provider.slice(1).toLowerCase()}`,this.walletRef=new Ie({}),this.authData=this.walletRef.getAuthData(),this.logo=this.logos[t]}async connect(){const t=await this.walletRef.connect({provider:this.provider});t&&(this.authData=t?.meta,this.authDataListeners.forEach(r=>r(t?.meta)))}async reconnect(){const t=await this.walletRef.connect({provider:this.provider});return t&&(this.authData=t?.meta,this.authDataListeners.forEach(r=>r(this.authData))),this.authData}onAuthDataChange(t){this.authDataListeners.push(t)}getAuthData(){return this.authData}async disconnect(){this.walletRef.logout(),this.authData=null}async getActiveAddress(){return await this.walletRef.getActiveAddress()}async getAllAddresses(){return[await this.getActiveAddress()]}async sign(t,r){throw new Error("Sign is not implemented in WAuth yet")}async getPermissions(){return await this.walletRef.getPermissions()}async getWalletNames(){return await this.walletRef.getWalletNames()}encrypt(t,r){throw new Error("Encrypt is not implemented in WAuth yet")}decrypt(t,r){throw new Error("Decrypt is not implemented in WAuth yet")}async getArweaveConfig(){return await this.walletRef.getArweaveConfig()}async isAvailable(){return!0}async dispatch(t){throw new Error("Dispatch is not implemented in WAuth yet")}async signDataItem(t){throw new Error("Sign data item is not implemented in WAuth yet")}addAddressEvent(t){return this.addressListeners.push(t),t}removeAddressEvent(t){this.addressListeners.splice(this.addressListeners.indexOf(t),1)}}function Ur(i,t,r){let s=r.length,n=t.length,c=s,o=0,a=0,h=t[n-1].nextSibling,f=null;for(;o<n||a<c;){if(t[o]===r[a]){o++,a++;continue}for(;t[n-1]===r[c-1];)n--,c--;if(n===o){const C=c<s?a?r[a-1].nextSibling:r[c-a]:h;for(;a<c;)i.insertBefore(r[a++],C)}else if(c===a)for(;o<n;)(!f||!f.has(t[o]))&&t[o].remove(),o++;else if(t[o]===r[c-1]&&r[a]===t[n-1]){const C=t[--n].nextSibling;i.insertBefore(r[a++],t[o++].nextSibling),i.insertBefore(r[--c],C),t[n]=r[c]}else{if(!f){f=new Map;let E=a;for(;E<c;)f.set(r[E],E++)}const C=f.get(t[o]);if(C!=null)if(a<C&&C<c){let E=o,I=1,A;for(;++E<n&&E<c&&!((A=f.get(t[E]))==null||A!==C+I);)I++;if(I>C-a){const x=t[o];for(;a<C;)i.insertBefore(r[a++],x)}else i.replaceChild(r[a++],t[o++])}else o++;else t[o++].remove()}}}const jt="_$DX_DELEGATE";function Ae(i,t,r,s){let n;const c=()=>{const a=document.createElement("template");return a.innerHTML=i,a.content.firstChild},o=()=>(n||(n=c())).cloneNode(!0);return o.cloneNode=o,o}function Lr(i,t=window.document){const r=t[jt]||(t[jt]=new Set);for(let s=0,n=i.length;s<n;s++){const c=i[s];r.has(c)||(r.add(c),t.addEventListener(c,Dr))}}function $t(i,t,r){ft(i)||(r==null?i.removeAttribute(t):i.setAttribute(t,r))}function Ee(i,t){ft(i)||(t==null?i.removeAttribute("class"):i.className=t)}function be(i,t,r,s){if(r!==void 0&&!s&&(s=[]),typeof t!="function")return et(i,t,s,r);L.createRenderEffect(n=>et(i,t(),n,r),s)}function ft(i){return!!L.sharedConfig.context&&!L.sharedConfig.done&&(!i||i.isConnected)}function Dr(i){if(L.sharedConfig.registry&&L.sharedConfig.events&&L.sharedConfig.events.find(([h,f])=>f===i))return;let t=i.target;const r=`$$${i.type}`,s=i.target,n=i.currentTarget,c=h=>Object.defineProperty(i,"target",{configurable:!0,value:h}),o=()=>{const h=t[r];if(h&&!t.disabled){const f=t[`${r}Data`];if(f!==void 0?h.call(t,f,i):h.call(t,i),i.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(i.target)&&c(t.host),!0},a=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(i,"currentTarget",{configurable:!0,get(){return t||document}}),L.sharedConfig.registry&&!L.sharedConfig.done&&(L.sharedConfig.done=_$HY.done=!0),i.composedPath){const h=i.composedPath();c(h[0]);for(let f=0;f<h.length-2&&(t=h[f],!!o());f++){if(t._$host){t=t._$host,a();break}if(t.parentNode===n)break}}else a();c(s)}function et(i,t,r,s,n){const c=ft(i);if(c){!r&&(r=[...i.childNodes]);let h=[];for(let f=0;f<r.length;f++){const C=r[f];C.nodeType===8&&C.data.slice(0,2)==="!$"?C.remove():h.push(C)}r=h}for(;typeof r=="function";)r=r();if(t===r)return r;const o=typeof t,a=s!==void 0;if(i=a&&r[0]&&r[0].parentNode||i,o==="string"||o==="number"){if(c||o==="number"&&(t=t.toString(),t===r))return r;if(a){let h=r[0];h&&h.nodeType===3?h.data!==t&&(h.data=t):h=document.createTextNode(t),r=Ne(i,r,s,h)}else r!==""&&typeof r=="string"?r=i.firstChild.data=t:r=i.textContent=t}else if(t==null||o==="boolean"){if(c)return r;r=Ne(i,r,s)}else{if(o==="function")return L.createRenderEffect(()=>{let h=t();for(;typeof h=="function";)h=h();r=et(i,h,r,s)}),()=>r;if(Array.isArray(t)){const h=[],f=r&&Array.isArray(r);if(ut(h,t,r,n))return L.createRenderEffect(()=>r=et(i,h,r,s,!0)),()=>r;if(c){if(!h.length)return r;if(s===void 0)return r=[...i.childNodes];let C=h[0];if(C.parentNode!==i)return r;const E=[C];for(;(C=C.nextSibling)!==s;)E.push(C);return r=E}if(h.length===0){if(r=Ne(i,r,s),a)return r}else f?r.length===0?Mt(i,h,s):Ur(i,r,h):(r&&Ne(i),Mt(i,h));r=h}else if(t.nodeType){if(c&&t.parentNode)return r=a?[t]:t;if(Array.isArray(r)){if(a)return r=Ne(i,r,s,t);Ne(i,r,null,t)}else r==null||r===""||!i.firstChild?i.appendChild(t):i.replaceChild(t,i.firstChild);r=t}}return r}function ut(i,t,r,s){let n=!1;for(let c=0,o=t.length;c<o;c++){let a=t[c],h=r&&r[i.length],f;if(!(a==null||a===!0||a===!1))if((f=typeof a)=="object"&&a.nodeType)i.push(a);else if(Array.isArray(a))n=ut(i,a,h)||n;else if(f==="function")if(s){for(;typeof a=="function";)a=a();n=ut(i,Array.isArray(a)?a:[a],Array.isArray(h)?h:[h])||n}else i.push(a),n=!0;else{const C=String(a);h&&h.nodeType===3&&h.data===C?i.push(h):i.push(document.createTextNode(C))}}return n}function Mt(i,t,r=null){for(let s=0,n=t.length;s<n;s++)i.insertBefore(t[s],r)}function Ne(i,t,r,s){if(r===void 0)return i.textContent="";const n=s||document.createTextNode("");if(t.length){let c=!1;for(let o=t.length-1;o>=0;o--){const a=t[o];if(n!==a){const h=a.parentNode===i;!c&&!o?h?i.replaceChild(n,a):i.insertBefore(n,r):h&&a.remove()}else c=!0}}else i.insertBefore(n,r);return[n]}const Br="http://www.w3.org/2000/svg";function qr(i,t=!1){return t?document.createElementNS(Br,i):document.createElement(i)}function jr(i){const{useShadow:t}=i,r=document.createTextNode(""),s=()=>i.mount||document.body,n=L.getOwner();let c,o=!!L.sharedConfig.context;return L.createEffect(()=>{o&&(L.getOwner().user=o=!1),c||(c=L.runWithOwner(n,()=>L.createMemo(()=>i.children)));const a=s();if(a instanceof HTMLHeadElement){const[h,f]=L.createSignal(!1),C=()=>f(!0);L.createRoot(E=>be(a,()=>h()?E():c(),null)),L.onCleanup(C)}else{const h=qr(i.isSVG?"g":"div",i.isSVG),f=t&&h.attachShadow?h.attachShadow({mode:"open"}):h;Object.defineProperty(h,"_$host",{get(){return r.parentNode},configurable:!0}),be(f,c),a.appendChild(h),i.ref&&i.ref(h),L.onCleanup(()=>a.removeChild(h))}},void 0,{render:!o}),r}const $r="_outter_mjs0y_4",Mr="_backdrop_mjs0y_47",Fr="_container_mjs0y_59",Wr="_btn_mjs0y_92",Kr="_content_mjs0y_114",Hr="_head_mjs0y_133",Gr="_main_mjs0y_141",Jr="_foot_mjs0y_144",Se={outter:$r,backdrop:Mr,container:Fr,btn:Wr,content:Kr,head:Hr,main:Gr,foot:Jr},zr="wallet_kit_strategy_id";function Vr(){localStorage&&localStorage.removeItem(zr)}var Xr=Ae('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em viewBox="0 0 24 24"><path fill=currentColor d=M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z opacity=0.25></path><path fill=currentColor d=M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z><animateTransform attributeName=transform dur=1.612s repeatCount=indefinite type=rotate values="0 12 12;360 12 12">'),Zr=Ae('<button><svg xmlns=http://www.w3.org/2000/svg width=1.2em height=1.2em viewBox="0 0 24 24"><path d="m7.05 5.636l4.95 4.95l4.95-4.95l1.414 1.414l-4.95 4.95l4.95 4.95l-1.415 1.414l-4.95-4.95l-4.949 4.95l-1.414-1.414l4.95-4.95l-4.95-4.95z">'),Yr=Ae("<div>"),Qr=Ae("<button role=link>Install "),en=Ae("<div><div><img><div></div><div></div>"),tn=Ae("<div id=solid-arwallet-connector><div><div><div><h3></h3></div><div>Don't have a wallet? <a href=https://arwiki.wiki/#/en/wallets target=_blank>Get a new</a></div></div></div><div>"),rn=Ae("<span><span>Connecting..."),nn=Ae("<button>Back"),sn=Ae("<div>no strategies"),on=Ae("<button><span></span><img>");const Vt=L.createContext(),an=()=>Xr();function cn(i){let t=null;const r=()=>i?.config?.permissions||["ACCESS_ADDRESS","SIGN_TRANSACTION"],s=()=>i?.config?.strategies||null,n=()=>i?.config?.gatewayConfig||{host:"arweave.net",port:443,protocol:"https"},c=()=>i?.config?.appInfo||{name:window.location.hostname,logo:null},[o,a]=L.createSignal(!1),[h,f]=L.createSignal(),[C,E]=L.createSignal(!1),[I,A]=L.createSignal(!1),[x,_]=L.createSignal(),[B,F]=L.createSignal(),[D,W]=L.createSignal(!0),te=()=>it.getStrategy(x(),s()),N=L.createMemo(()=>`${n()?.protocol}://${n()?.host}`);L.onMount(()=>{E(!1),A(!1),it.syncStrategies(s(),r(),i?.config?.ensurePermissions).then($=>{$&&$.getActiveAddress().then(G=>{G&&(_($.id),f(G),a(!0))}).catch(G=>{throw G})}).catch($=>{console.log("[Arweave Wallet Kit] is not connected")}).finally(()=>A(!1))}),L.onCleanup(()=>{E(!1),A(!1),t!=null&&te()?.removeAddressEvent(t)});function O($){console.log("address changed : ",$),f($),a(!!$)}L.createEffect(()=>{o()&&(t=te()?.addAddressEvent(O)),C()?document.body.style.overflow="hidden":document.body.style.overflow="auto"});async function R(){if(!te()||!o()||I())throw new Error("[Arweave Wallet Kit] Not yet connected");try{return await te()?.disconnect(),Vr(x()||te()?.id),_(null),a(!1),f(null),t&&te()?.removeAddressEvent(t),Promise.resolve()}catch{throw new Error(`[Arweave Wallet Kit] Could not disconnect
`+(e?.message||e))}}async function U($){if($){F({name:$.name,logo:$.logo,url:$.url,theme:$.theme}),A(!0),W(!0);try{if(await $.isAvailable()){await $.connect(r(),c(),n());const X=await $.getActiveAddress();if(X)f(X),a(!0),it.saveStrategy($.id),_($.id),A(!1),F(null),E(!1);else{const ce=new Error(`Connecting ${$.name} faild.`);throw ce.code="FAILD",ce}}else{const X=new Error(`Not installed ${$.name}.`);throw X.code="UNINSTALL",X}}catch(G){G.code=="UNINSTALL"&&W(!1)}A(!1),F(null)}}const K=$=>(()=>{var G=tn(),X=G.firstChild,ce=X.firstChild,le=ce.firstChild,me=le.firstChild,Ce=le.nextSibling,pe=X.nextSibling;return be(me,(()=>{var q=L.createMemo(()=>!!I());return()=>q()?(()=>{var Y=rn();return Y.style.setProperty("display","inline-flex"),Y.style.setProperty("align-items","center"),Y.style.setProperty("gap","0.5em"),Y})():"Connect to a wallet"})()),be(le,L.createComponent(L.Show,{get when(){return!I()},get fallback(){return L.createMemo(()=>!!D())()?L.createComponent(an,{}):(()=>{var q=nn();return q.$$click=()=>{A(!1)},q})()},get children(){var q=Zr(),Y=q.firstChild,Q=Y.firstChild;return q.$$click=()=>E(!1),q.style.setProperty("background","transparent"),q.style.setProperty("padding","0"),q.style.setProperty("display","flex"),q.style.setProperty("justify-content","center"),q.style.setProperty("align-items","center"),Q.style.setProperty("fill","currentcolor"),L.createRenderEffect(()=>q.disabled=I()),q}}),null),be(ce,L.createComponent(L.Switch,{get children(){return[L.createComponent(L.Match,{get when(){return!I()},get children(){var q=Yr();return q.style.setProperty("display","flex"),q.style.setProperty("flex-direction","column"),q.style.setProperty("gap","1em"),be(q,L.createComponent(L.For,{get each(){return s()},get fallback(){return sn()},children:Y=>(()=>{var Q=on(),k=Q.firstChild,se=k.nextSibling;return Q.$$click=()=>{U(Y)},Q.style.setProperty("display","flex"),Q.style.setProperty("justify-content","space-between"),Q.style.setProperty("align-items","center"),be(k,()=>Y.name),se.style.setProperty("width","16px"),se.style.setProperty("height","16px"),se.style.setProperty("padding","6px"),se.style.setProperty("border-radius","6px"),se.style.setProperty("box-sizing","content-box"),L.createRenderEffect(Z=>{var we=Se.btn,ie=I(),oe=`${N()}/${Y.logo}`,l=`rgb(${Y.theme||"0,0,0"})`;return we!==Z.e&&Ee(Q,Z.e=we),ie!==Z.t&&(Q.disabled=Z.t=ie),oe!==Z.a&&$t(se,"src",Z.a=oe),l!==Z.o&&((Z.o=l)!=null?se.style.setProperty("background",l):se.style.removeProperty("background")),Z},{e:void 0,t:void 0,a:void 0,o:void 0}),Q})()})),L.createRenderEffect(()=>Ee(q,Se.main)),q}}),L.createComponent(L.Match,{get when(){return I()},get children(){var q=en(),Y=q.firstChild,Q=Y.firstChild,k=Q.nextSibling,se=k.nextSibling;return q.style.setProperty("display","flex"),q.style.setProperty("flex-direction","column"),q.style.setProperty("gap","1em"),Y.style.setProperty("display","flex"),Y.style.setProperty("flex-direction","column"),Y.style.setProperty("width","100%"),Y.style.setProperty("justify-content","center"),Y.style.setProperty("align-items","center"),Y.style.setProperty("gap","0.5em"),Q.style.setProperty("width","48px"),Q.style.setProperty("height","48px"),Q.style.setProperty("padding","16px"),Q.style.setProperty("border-radius","16px"),Q.style.setProperty("box-sizing","content-box"),be(k,()=>B()?.name),se.style.setProperty("font-size","0.8em"),se.style.setProperty("opacity","0.6"),se.style.setProperty("text-align","center"),be(se,(()=>{var Z=L.createMemo(()=>!!D());return()=>Z()?"Confirm connection request in the wallet popup window":`Not installed ${B()?.name} `})()),be(q,L.createComponent(L.Show,{get when(){return!D()},get children(){var Z=Qr();return Z.firstChild,be(Z,()=>B()?.name,null),L.createRenderEffect(()=>Ee(Z,Se.btn)),Z}}),null),L.createRenderEffect(Z=>{var we=Se.main,ie=`${N()}/${B()?.logo}`,oe=`rgb(${B()?.theme||"0,0,0"})`;return we!==Z.e&&Ee(q,Z.e=we),ie!==Z.t&&$t(Q,"src",Z.t=ie),oe!==Z.a&&((Z.a=oe)!=null?Q.style.setProperty("background",oe):Q.style.removeProperty("background")),Z},{e:void 0,t:void 0,a:void 0}),q}})]}}),Ce),L.createRenderEffect(q=>{var Y=Se.outter,Q=`${C()?"visible":"hidden"}`,k=Se.container,se=`${C()?"0% 0%":"0% 50%"}`,Z=`${C()?"100":"0"}`,we=Se.content,ie=Se.head,oe=Se.foot,l=Se.backdrop,u=`${C()?"100":"0"}`;return Y!==q.e&&Ee(G,q.e=Y),Q!==q.t&&((q.t=Q)!=null?G.style.setProperty("visibility",Q):G.style.removeProperty("visibility")),k!==q.a&&Ee(X,q.a=k),se!==q.o&&((q.o=se)!=null?X.style.setProperty("translate",se):X.style.removeProperty("translate")),Z!==q.i&&((q.i=Z)!=null?X.style.setProperty("opacity",Z):X.style.removeProperty("opacity")),we!==q.n&&(ce.className=q.n=we),ie!==q.s&&Ee(le,q.s=ie),oe!==q.h&&Ee(Ce,q.h=oe),l!==q.r&&Ee(pe,q.r=l),u!==q.d&&((q.d=u)!=null?pe.style.setProperty("opacity",u):pe.style.removeProperty("opacity")),q},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),G})(),P=()=>{if(o()){console.log("[Arweave Wallet Kit] Already connected");return}I()||(f(null),_(null),E(!0))},H={connected:o,connecting:I,address:h,showConnector:P,wallet:te,disconnect:R,walletConnectionCheck:($,G)=>{$.addEventListener("click",X=>{o()?G()?.():(P(),X.preventDefault())})}};return L.createComponent(Vt.Provider,{value:H,get children(){return[L.createMemo(()=>i.children),L.createComponent(jr,{get children(){return L.createComponent(K,{})}})]}})}function ln(){return L.useContext(Vt)}Lr(["click"]);exports.BrowserWalletStrategy=Yt;exports.WAuthStrategy=xr;exports.WalletProvider=cn;exports.useWallet=ln;
